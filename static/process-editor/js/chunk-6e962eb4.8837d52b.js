(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6e962eb4"],{"00ee":function(e,t,i){"use strict";var s=i("b622"),o=s("toStringTag"),l={};l[o]="z",e.exports="[object z]"===String(l)},"0cb2":function(e,t,i){"use strict";var s=i("e330"),o=i("7b0b"),l=Math.floor,n=s("".charAt),r=s("".replace),a=s("".slice),c=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,d=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,i,s,u,p){var m=i+e.length,h=s.length,f=d;return void 0!==u&&(u=o(u),f=c),r(p,f,(function(o,r){var c;switch(n(r,0)){case"$":return"$";case"&":return e;case"`":return a(t,0,i);case"'":return a(t,m);case"<":c=u[a(r,1,-1)];break;default:var d=+r;if(0===d)return o;if(d>h){var p=l(d/10);return 0===p?o:p<=h?void 0===s[p-1]?n(r,1):s[p-1]+n(r,1):o}c=s[d-1]}return void 0===c?"":c}))}},"0d51":function(e,t,i){},1127:function(e,t,i){},"12df":function(e,t,i){},"12fc":function(e,t,i){},1372:function(e,t,i){},"1e5a":function(e,t,i){"use strict";var s=i("23e7"),o=i("9961"),l=i("dad2");s({target:"Set",proto:!0,real:!0,forced:!l("symmetricDifference")},{symmetricDifference:o})},"1e70":function(e,t,i){"use strict";var s=i("23e7"),o=i("a5f7"),l=i("dad2");s({target:"Set",proto:!0,real:!0,forced:!l("difference")},{difference:o})},"21c7":function(e,t,i){"use strict";i("3d6c")},"24fd":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"c",(function(){return l})),i.d(t,"b",(function(){return n}));var s=i("0c6d");function o({deptId:e,type:t}){const i={parentId:{}};return e?i.parentId["eq"]=e:i.parentId["empty"]="true",Object(s["a"])({url:"/cloud/app/app-org",method:"get",params:{filter:JSON.stringify(i)}})}function l({orgIds:e,roleIds:t,name:i}){const o={orgs:{id:{in:e||""}},roles:{id:{in:t||""}},name:{like:i||""}};return e&&(o["orgs"]={id:{in:e}}),t&&(o["roles"]={id:{in:t}}),i&&(o["name"]={like:i}),Object(s["a"])({url:"/cloud/app/app-user",method:"get",params:{filter:JSON.stringify(o)}})}function n(e){return Object(s["a"])({url:"/cloud/app/app-role",method:"get",params:e})}},"264d":function(e,t,i){"use strict";i("0d51")},"2a62":function(e,t,i){"use strict";var s=i("c65b"),o=i("825a"),l=i("dc4a");e.exports=function(e,t,i){var n,r;o(e);try{if(n=l(e,"return"),!n){if("throw"===t)throw i;return i}n=s(n,e)}catch(a){r=!0,n=a}if("throw"===t)throw i;if(r)throw n;return o(n),i}},"2b36":function(e,t,i){"use strict";var s=function(){var e=this,t=e._self._c;return t("el-form",{ref:"form",staticClass:"process-form",attrs:{"label-position":"top",rules:e.rules,model:e._value}},e._l(e.forms,(function(i,s){return"SpanLayout"!==i.name&&"Description"!==i.name?t("el-form-item",{key:i.name+s,attrs:{prop:i.id,label:i.title}},[t("form-design-render",{ref:"sub-item_"+i.id,refInFor:!0,attrs:{mode:"PC",config:i},model:{value:e._value[i.id],callback:function(t){e.$set(e._value,i.id,t)},expression:"_value[item.id]"}})],1):t("form-design-render",{ref:"span-layout",attrs:{mode:"PC",config:i},model:{value:e._value,callback:function(t){e._value=t},expression:"_value"}})})),1)},o=[],l=i("d16b"),n={name:"FormRender",components:{FormDesignRender:l["a"]},props:{forms:{type:Array,default:()=>[]},value:{type:Object,default:()=>({})}},data(){return{rules:{}}},created(){this.loadFormConfig(this.forms)},computed:{_value:{get(){return this.value},set(e){this.$emit("input",e)}}},methods:{validate(e){let t=!0;this.$refs.form.validate(i=>{if(t=i,i)for(let e=0;e<this.forms.length;e++)if("TableList"===this.forms[e].name){let i=this.$refs["sub-item_"+this.forms[e].id];if(i&&Array.isArray(i)&&i.length>0&&(i[0].validate(e=>{t=e}),!t))break}e(t)})},loadFormConfig(e){e.forEach(e=>{"SpanLayout"===e.name?this.loadFormConfig(e.props.items):(this.$set(this._value,e.id,this.value[e.id]),e.props.required&&this.$set(this.rules,e.id,[{type:"Array"===e.valueType?"array":void 0,required:!0,message:"请填写"+e.title,trigger:"blur"}]))})}}},r=n,a=(i("71fa"),i("2877")),c=Object(a["a"])(r,s,o,!1,null,"3da7fc04",null);t["a"]=c.exports},3421:function(e,t,i){},3540:function(e,t,i){"use strict";i("6277")},"36a9":function(e,t,i){},"384f":function(e,t,i){"use strict";var s=i("e330"),o=i("5388"),l=i("cb27"),n=l.Set,r=l.proto,a=s(r.forEach),c=s(r.keys),d=c(new n).next;e.exports=function(e,t,i){return i?o({iterator:c(e),next:d},t):a(e,t)}},"395e":function(e,t,i){"use strict";var s=i("dc19"),o=i("cb27").has,l=i("8e16"),n=i("7f65"),r=i("5388"),a=i("2a62");e.exports=function(e){var t=s(this),i=n(e);if(l(t)<i.size)return!1;var c=i.getIterator();return!1!==r(c,(function(e){if(!o(t,e))return a(c,"normal",!1)}))}},"3d6c":function(e,t,i){},"3ea0":function(e,t,i){},"3f0c":function(e,t,i){},"41f4":function(e,t,i){e.exports=i.p+"img/code.09fdd434.png"},"442e":function(e,t,i){},"44da":function(e,t,i){"use strict";i("3ea0")},"44e7":function(e,t,i){"use strict";var s=i("861d"),o=i("c6b6"),l=i("b622"),n=l("match");e.exports=function(e){var t;return s(e)&&(void 0!==(t=e[n])?!!t:"RegExp"===o(e))}},"46c4":function(e,t,i){"use strict";e.exports=function(e){return{iterator:e,next:e.next,done:!1}}},4894:function(e,t,i){"use strict";i("edd1")},"4e02":function(e,t,i){"use strict";i.d(t,"b",(function(){return o})),i.d(t,"c",(function(){return l})),i.d(t,"f",(function(){return n})),i.d(t,"d",(function(){return r})),i.d(t,"a",(function(){return a})),i.d(t,"e",(function(){return c}));var s=i("0c6d");function o(e){return Object(s["a"])({url:"/cloud/app/app-process-group",method:"get",params:e})}function l(e){return Object(s["a"])({url:"admin/form/group/sort",method:"put",data:e})}function n(e,t){return Object(s["a"])({url:"admin/form/group",method:t,params:e})}function r(e){}function a(e){return Object(s["a"])({url:"/cloud/app/app-process-def/"+e,method:"get"})}function c(e){return Object(s["a"])({url:"/cloud/app/app-process-def/wflow",method:"post",data:e})}},"510e":function(e,t,i){"use strict";i("db72")},5372:function(e,t,i){},5388:function(e,t,i){"use strict";var s=i("c65b");e.exports=function(e,t,i){var o,l,n=i?e:e.iterator,r=e.next;while(!(o=s(r,n)).done)if(l=t(o.value),void 0!==l)return l}},"577e":function(e,t,i){"use strict";var s=i("f5df"),o=String;e.exports=function(e){if("Symbol"===s(e))throw new TypeError("Cannot convert a Symbol value to a string");return o(e)}},"5b81":function(e,t,i){"use strict";var s=i("23e7"),o=i("c65b"),l=i("e330"),n=i("1d80"),r=i("1626"),a=i("7234"),c=i("44e7"),d=i("577e"),u=i("dc4a"),p=i("90d8"),m=i("0cb2"),h=i("b622"),f=i("c430"),v=h("replace"),g=TypeError,b=l("".indexOf),y=l("".replace),_=l("".slice),k=Math.max;s({target:"String",proto:!0},{replaceAll:function(e,t){var i,s,l,h,x,S,w,C,N,$,O=n(this),I=0,E="";if(!a(e)){if(i=c(e),i&&(s=d(n(p(e))),!~b(s,"g")))throw new g("`.replaceAll` does not allow non-global regexes");if(l=u(e,v),l)return o(l,e,O,t);if(f&&i)return y(d(O),e,t)}h=d(O),x=d(e),S=r(t),S||(t=d(t)),w=x.length,C=k(1,w),N=b(h,x);while(-1!==N)$=S?d(t(x,N,h)):m(x,h,N,[],void 0,t),E+=_(h,I,N)+$,I=N+w,N=N+C>h.length?-1:b(h,x,N+C);return I<h.length&&(E+=_(h,I)),E}})},6277:function(e,t,i){},"63ad":function(e,t,i){"use strict";i("78aa")},"655f":function(e,t,i){"use strict";i("12df")},"673a":function(e,t,i){"use strict";i("e47a")},"68ce":function(e,t,i){},"68df":function(e,t,i){"use strict";var s=i("dc19"),o=i("8e16"),l=i("384f"),n=i("7f65");e.exports=function(e){var t=s(this),i=n(e);return!(o(t)>i.size)&&!1!==l(t,(function(e){if(!i.includes(e))return!1}),!0)}},"6cd9":function(e,t,i){"use strict";i("91da")},"6ef6":function(e,t,i){"use strict";i("442e")},"709c":function(e,t,i){"use strict";var s=function(){var e=this,t=e._self._c;return t("w-dialog",{attrs:{border:!1,closeFree:"",width:"800px",title:e.title},on:{ok:e.selectOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{staticClass:"picker"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"candidate"},[t("div",[t("ellipsis",{staticStyle:{height:"18px",color:"#8c8c8c",padding:"7px 0"},attrs:{hoverTip:"",row:1,content:e.deptStackStr}},[t("i",{staticClass:"el-icon-office-building",attrs:{slot:"pre"},slot:"pre"})]),t("div",[t("el-checkbox",{attrs:{disabled:!e.multiple},on:{change:e.handleCheckAllChange},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}},[e._v("全选")]),t("span",{directives:[{name:"show",rawName:"v-show",value:e.deptStack.length>0,expression:"deptStack.length > 0"}],staticClass:"top-dept",on:{click:e.beforeNode}},[e._v("上一级")])],1)],1),t("div",{staticClass:"org-items"},[t("el-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.orgs.length,expression:"orgs.length === 0"}],attrs:{"image-size":100,description:"似乎没有数据"}}),e._l(e.orgs,(function(i,s){return t("div",{key:s,class:e.orgItemClass(i),on:{click:function(t){return e.selectChange(i,"dept")}}},[t("el-checkbox",{attrs:{value:i.selected,disabled:e.disableDept(i)}}),t("div",{staticStyle:{display:"flex","align-items":"center",flex:"1"}},[t("i",{staticClass:"el-icon-folder-opened"}),t("span",{staticClass:"name"},[e._v(e._s(i.name))]),t("span",{class:"next-dept"+(i.selected?"-disable":""),on:{click:function(t){return t.stopPropagation(),e.nextNode(i)}}},[t("i",{staticClass:"iconfont icon-map-site"}),e._v("下级 ")])])],1)}))],2)]),t("div",{staticClass:"users"},[t("div",{staticClass:"search-wrapper"},[t("el-input",{staticClass:"search-input",attrs:{size:"small",clearable:"",placeholder:"搜索人员，姓名模糊搜索","prefix-icon":"el-icon-search"},on:{input:e.searchUser},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),t("div",{staticClass:"org-items"},[t("el-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.searchUserList.length,expression:"searchUserList.length === 0"}],attrs:{"image-size":100,description:"似乎没有数据"}}),e._l(e.searchUserList,(function(i,s){return t("div",{key:s,class:e.orgItemClass(i),on:{click:function(t){return e.selectChange(i,"user")}}},[t("el-checkbox",{attrs:{value:i.selected,disabled:e.disableDept(i)}}),t("div",{staticStyle:{display:"flex","align-items":"center"}},[e.$isNotEmpty(i.avatar)?t("el-avatar",{attrs:{size:35,src:i.avatar}}):e._e(),t("span",{staticClass:"name"},[e._v(e._s(i.name||i.login))])],1)],1)}))],2)]),t("div",{staticClass:"selected"},[t("div",{staticClass:"count"},[t("span",[e._v("已选 "+e._s(e.select.length)+" 项")]),t("span",{on:{click:e.clearSelected}},[e._v("清空")])]),t("div",{staticClass:"org-items",staticStyle:{height:"350px"}},[t("el-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.select.length,expression:"select.length === 0"}],attrs:{"image-size":100,description:"请点击左侧列表选择数据"}}),e._l(e.select,(function(i,s){return t("div",{key:s,class:e.orgItemClass(i)},["dept"===i.type?t("div",[t("i",{staticClass:"el-icon-folder-opened"}),t("span",{staticClass:"name",staticStyle:{position:"static"}},[e._v(e._s(i.name))])]):"user"===i.type?t("div",{staticStyle:{display:"flex","align-items":"center"}},[e.$isNotEmpty(i.avatar)?t("el-avatar",{attrs:{size:35,src:i.avatar}}):t("span",{staticClass:"avatar"},[e._v(e._s(e.getShortName(i.name)))]),t("span",{staticClass:"name"},[e._v(e._s(i.name||i.login))])],1):t("div",[t("i",{staticClass:"iconfont icon-bumen"}),t("span",{staticClass:"name"},[e._v(e._s(i.name))])]),t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.noSelected(s)}}})])}))],2)])])])},o=[],l=(i("14d9"),i("5b81"),i("24fd")),n={name:"OrgPicker",components:{},props:{title:{default:"请选择",type:String},type:{default:"org",type:String},multiple:{default:!1,type:Boolean},selected:{default:()=>[],type:Array}},data(){return{visible:!1,loading:!1,checkAll:!1,nowDeptId:null,isIndeterminate:!1,searchUserList:[],nodes:[],select:[],search:"",deptStack:[]}},computed:{deptStackStr(){return String(this.deptStack.map(e=>e.name)).replaceAll(","," > ")},orgs(){return this.nodes}},methods:{show(){this.visible=!0,this.init(),this.getOrgList()},orgItemClass(e){return{"org-item":!0,"org-dept-item":"dept"===e.type,"org-user-item":"user"===e.type}},disableDept(e){return"user"===this.type&&"dept"===e.type},getOrgList(){this.loading=!0,Object(l["a"])({deptId:this.nowDeptId,type:this.type}).then(e=>(this.loading=!1,this.nodes=e.data,Object(l["c"])({orgIds:this.nowDeptId}))).then(e=>{this.searchUserList=e.data,this.selectToLeft()}).catch(e=>{this.loading=!1,this.$message.error(e.response.data)})},getShortName(e){return e?e.length>2?e.substring(1,3):e:"**"},searchUser(){let e=this.search.trim();this.searchUserList=[],this.loading=!0,Object(l["c"])({name:e}).then(e=>{this.loading=!1,this.searchUserList=e.data.map(e=>(e.userId=e.id,e.id=e.login,e)),this.selectToLeft()}).catch(e=>{this.loading=!1,this.$message.error("接口异常")})},selectToLeft(){this.select=Object.assign([],this.selected),this.nodes.forEach(e=>{this.select.filter(e=>"dept"===e.type).map(e=>e.id).includes(e.id)?e.selected=!0:e.selected=!1}),this.searchUserList.forEach(e=>{this.select.filter(e=>"user"===e.type).map(e=>e.id).includes(e.id)?e.selected=!0:e.selected=!1})},selectChange(e,t){if(e.selected){this.checkAll=!1;for(let t=0;t<this.select.length;t++)if(this.select[t].id===e.id){this.select.splice(t,1);break}e.selected=!1}else if(!this.disableDept(e)){e.selected=!0,e.type=t;let i="dept"===t?this.nodes:this.searchUserList;this.multiple||i.forEach(t=>{e.id!==t.id&&(t.selected=!1)}),"dept"===e.type?this.multiple?this.select.unshift(e):this.select=[e]:this.multiple?this.select.push(e):this.select=[e]}},noSelected(e){let t=this.nodes;for(let i=0;i<2;i++){for(let i=0;i<t.length;i++)if(t[i].id===this.select[e].id){t[i].selected=!1,this.checkAll=!1;break}t=this.searchUserList}this.select.splice(e,1)},handleCheckAllChange(){this.nodes.forEach(e=>{if(this.checkAll)e.selected||this.disableDept(e)||(e.selected=!0,this.select.push(e));else{e.selected=!1;for(let t=0;t<this.select.length;t++)if(this.select[t].id===e.id){this.select.splice(t,1);break}}})},nextNode(e){this.nowDeptId=e.id,this.deptStack.push(e),this.getOrgList()},beforeNode(){0!==this.deptStack.length&&(this.deptStack.length<2?this.nowDeptId=null:this.nowDeptId=this.deptStack[this.deptStack.length-2].id,this.deptStack.splice(this.deptStack.length-1,1),this.getOrgList())},recover(){this.select=[],this.nodes.forEach(e=>e.selected=!1)},selectOk(){this.$emit("ok",Object.assign([],this.select.map(e=>({id:e.id,name:e.name||e.login,type:e.type,code:"dept"===e.type?e.code:null,login:"user"===e.type?e.login:null})))),this.visible=!1,this.recover()},clearSelected(){this.$confirm("您确定要清空已选中的项?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.recover()})},close(){this.$emit("close"),this.recover()},init(){this.checkAll=!1,this.nowDeptId=null,this.deptStack=[],this.nodes=[],this.selectToLeft()}}},r=n,a=(i("21c7"),i("2877")),c=Object(a["a"])(r,s,o,!1,null,"256ffd70",null);t["a"]=c.exports},"71fa":function(e,t,i){"use strict";i("5372")},7282:function(e,t,i){"use strict";var s=i("e330"),o=i("59ed");e.exports=function(e,t,i){try{return s(o(Object.getOwnPropertyDescriptor(e,t)[i]))}catch(l){}}},"72c3":function(e,t,i){"use strict";var s=i("23e7"),o=i("e9bc"),l=i("dad2");s({target:"Set",proto:!0,real:!0,forced:!l("union")},{union:o})},"770c":function(e,t,i){"use strict";i("f405")},"78aa":function(e,t,i){},"79a4":function(e,t,i){"use strict";var s=i("23e7"),o=i("d039"),l=i("953b"),n=i("dad2"),r=!n("intersection")||o((function(){return"3,2"!==String(Array.from(new Set([1,2,3]).intersection(new Set([3,2]))))}));s({target:"Set",proto:!0,real:!0,forced:r},{intersection:l})},"7ce0":function(e,t,i){"use strict";i("cd82")},"7f65":function(e,t,i){"use strict";var s=i("59ed"),o=i("825a"),l=i("c65b"),n=i("5926"),r=i("46c4"),a="Invalid size",c=RangeError,d=TypeError,u=Math.max,p=function(e,t){this.set=e,this.size=u(t,0),this.has=s(e.has),this.keys=s(e.keys)};p.prototype={getIterator:function(){return r(o(l(this.keys,this.set)))},includes:function(e){return l(this.has,this.set,e)}},e.exports=function(e){o(e);var t=+e.size;if(t!==t)throw new d(a);var i=n(t);if(i<0)throw new c(a);return new p(e,i)}},8032:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));const s={string:"String",object:"Object",array:"Array",number:"Number",date:"Date",user:"User",dept:"Dept",dateRange:"DateRange"};s.array,s.string,s.string,s.number,s.number,s.string,s.array,s.date,s.dateRange,s.array,s.array,s.user,s.dept,s.string,s.array},"83b9":function(e,t,i){"use strict";var s=i("cb27"),o=i("384f"),l=s.Set,n=s.add;e.exports=function(e){var t=new l;return o(e,(function(e){n(t,e)})),t}},"875f":function(e,t,i){},"8b00":function(e,t,i){"use strict";var s=i("23e7"),o=i("68df"),l=i("dad2");s({target:"Set",proto:!0,real:!0,forced:!l("isSubsetOf")},{isSubsetOf:o})},"8e16":function(e,t,i){"use strict";var s=i("7282"),o=i("cb27");e.exports=s(o.proto,"size","get")||function(e){return e.size}},"90d8":function(e,t,i){"use strict";var s=i("c65b"),o=i("1a2d"),l=i("3a9b"),n=i("ad6d"),r=RegExp.prototype;e.exports=function(e){var t=e.flags;return void 0!==t||"flags"in r||o(e,"flags")||!l(r,e)?t:s(n,e)}},"91da":function(e,t,i){},"953b":function(e,t,i){"use strict";var s=i("dc19"),o=i("cb27"),l=i("8e16"),n=i("7f65"),r=i("384f"),a=i("5388"),c=o.Set,d=o.add,u=o.has;e.exports=function(e){var t=s(this),i=n(e),o=new c;return l(t)>i.size?a(i.getIterator(),(function(e){u(t,e)&&d(o,e)})):r(t,(function(e){i.includes(e)&&d(o,e)})),o}},"982c":function(e,t,i){"use strict";i("d53d")},9961:function(e,t,i){"use strict";var s=i("dc19"),o=i("cb27"),l=i("83b9"),n=i("7f65"),r=i("5388"),a=o.add,c=o.has,d=o.remove;e.exports=function(e){var t=s(this),i=n(e).getIterator(),o=l(t);return r(i,(function(e){c(t,e)?d(o,e):a(o,e)})),o}},"9c9c":function(e,t,i){"use strict";i("fd73")},a2c5:function(e){e.exports=JSON.parse('{"id":"3538338","name":"wflow","font_family":"iconfont","css_prefix_text":"icon-","description":"","glyphs":[{"icon_id":"807897","name":"iconfont-kefu","font_class":"iconfontkefu","unicode":"e61c","unicode_decimal":58908},{"icon_id":"1313126","name":"BBD密码","font_class":"mima","unicode":"e648","unicode_decimal":58952},{"icon_id":"2131309","name":"人力社保","font_class":"renlishebao","unicode":"e636","unicode_decimal":58934},{"icon_id":"4774868","name":"部门","font_class":"bumen","unicode":"e758","unicode_decimal":59224},{"icon_id":"6337457","name":"插入图片","font_class":"charutupian","unicode":"ec7f","unicode_decimal":60543},{"icon_id":"2958951","name":"考勤管理","font_class":"kaoqinguanli","unicode":"e610","unicode_decimal":58896},{"icon_id":"3007689","name":"身份证","font_class":"shenfenzheng","unicode":"e614","unicode_decimal":58900},{"icon_id":"5121522","name":"位置","font_class":"weizhi","unicode":"e64b","unicode_decimal":58955},{"icon_id":"7568869","name":"24gf-phoneBubble","font_class":"24gf-phoneBubble","unicode":"e966","unicode_decimal":59750},{"icon_id":"11134714","name":"考勤","font_class":"kaoqin","unicode":"e643","unicode_decimal":58947},{"icon_id":"15972093","name":"会议","font_class":"huiyi","unicode":"e61b","unicode_decimal":58907},{"icon_id":"19883444","name":"加班","font_class":"jiaban","unicode":"e637","unicode_decimal":58935},{"icon_id":"1392555","name":"表格","font_class":"biaoge","unicode":"e665","unicode_decimal":58981},{"icon_id":"3868276","name":"使用文档","font_class":"shiyongwendang","unicode":"eb66","unicode_decimal":60262},{"icon_id":"5881147","name":"多选框","font_class":"duoxuankuang","unicode":"e62e","unicode_decimal":58926},{"icon_id":"26323690","name":"单选","font_class":"danxuan","unicode":"e751","unicode_decimal":59217},{"icon_id":"5032","name":"出租","font_class":"chuzu","unicode":"e600","unicode_decimal":58880},{"icon_id":"1079372","name":"招聘","font_class":"zhaopin","unicode":"e647","unicode_decimal":58951},{"icon_id":"1183143","name":"财务","font_class":"caiwu","unicode":"e67d","unicode_decimal":59005},{"icon_id":"1727267","name":"05采购","font_class":"caigou","unicode":"e887","unicode_decimal":59527},{"icon_id":"1876349","name":"我的产品","font_class":"wodechanpin","unicode":"e679","unicode_decimal":59001},{"icon_id":"1977843","name":"发票管理","font_class":"fapiaoguanli","unicode":"e63b","unicode_decimal":58939},{"icon_id":"7790995","name":"工资","font_class":"gongzi","unicode":"e7e9","unicode_decimal":59369},{"icon_id":"10120009","name":"住房补贴账户","font_class":"zhufangbutiezhanghu","unicode":"e60c","unicode_decimal":58892},{"icon_id":"11435446","name":"维修","font_class":"weixiu","unicode":"e613","unicode_decimal":58899},{"icon_id":"11435453","name":"员工离职","font_class":"yuangonglizhi","unicode":"e615","unicode_decimal":58901},{"icon_id":"11435456","name":"招聘管理","font_class":"zhaopinguanli","unicode":"e616","unicode_decimal":58902},{"icon_id":"12911861","name":"财务","font_class":"caiwu1","unicode":"e603","unicode_decimal":58883},{"icon_id":"14443545","name":"请假申请","font_class":"qingjiashenqing","unicode":"e60d","unicode_decimal":58893},{"icon_id":"14947326","name":"出差","font_class":"ziyuan207","unicode":"e722","unicode_decimal":59170},{"icon_id":"17187052","name":"用餐就餐","font_class":"yongcanjiucan","unicode":"e67e","unicode_decimal":59006},{"icon_id":"18170995","name":"地图组织站点,层级,下级,组织架构布局","font_class":"map-site","unicode":"ea00","unicode_decimal":59904},{"icon_id":"21053836","name":"合同","font_class":"hetong","unicode":"e68a","unicode_decimal":59018},{"icon_id":"21159370","name":"补卡","font_class":"buka","unicode":"e6ca","unicode_decimal":59082},{"icon_id":"24080655","name":"出差","font_class":"chucha","unicode":"e6c7","unicode_decimal":59079},{"icon_id":"24283254","name":"报销申请-费用报销申请-02","font_class":"baoxiaoshenqing-feiyongbaoxiaoshenqing-02","unicode":"e726","unicode_decimal":59174},{"icon_id":"29522596","name":"11C分组,组织树","font_class":"a-11Cfenzuzuzhishu","unicode":"e676","unicode_decimal":58998}]}')},a4e7:function(e,t,i){"use strict";var s=i("23e7"),o=i("395e"),l=i("dad2");s({target:"Set",proto:!0,real:!0,forced:!l("isSupersetOf")},{isSupersetOf:o})},a5f7:function(e,t,i){"use strict";var s=i("dc19"),o=i("cb27"),l=i("83b9"),n=i("8e16"),r=i("7f65"),a=i("384f"),c=i("5388"),d=o.has,u=o.remove;e.exports=function(e){var t=s(this),i=r(e),o=l(t);return n(t)<=i.size?a(t,(function(e){i.includes(e)&&u(o,e)})):c(i.getIterator(),(function(e){d(t,e)&&u(o,e)})),o}},ad6d:function(e,t,i){"use strict";var s=i("825a");e.exports=function(){var e=s(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},b31a:function(e,t,i){"use strict";i("e8df")},b466:function(e,t,i){"use strict";i("36a9")},b4bc:function(e,t,i){"use strict";var s=i("dc19"),o=i("cb27").has,l=i("8e16"),n=i("7f65"),r=i("384f"),a=i("5388"),c=i("2a62");e.exports=function(e){var t=s(this),i=n(e);if(l(t)<=i.size)return!1!==r(t,(function(e){if(i.includes(e))return!1}),!0);var d=i.getIterator();return!1!==a(d,(function(e){if(o(t,e))return c(d,"normal",!1)}))}},bb26:function(e,t,i){"use strict";i("1127")},bb50:function(e,t,i){"use strict";i("3421")},c1a1:function(e,t,i){"use strict";var s=i("23e7"),o=i("b4bc"),l=i("dad2");s({target:"Set",proto:!0,real:!0,forced:!l("isDisjointFrom")},{isDisjointFrom:o})},c787:function(e,t,i){"use strict";i("fcc0")},c87a:function(e,t,i){"use strict";i("12fc")},c8be:function(e,t,i){"use strict";i("68ce")},c8d6:function(e,t,i){"use strict";i("3f0c")},cb27:function(e,t,i){"use strict";var s=i("e330"),o=Set.prototype;e.exports={Set:Set,add:s(o.add),has:s(o.has),remove:s(o["delete"]),proto:o}},cd82:function(e,t,i){},d16b:function(e,t,i){"use strict";var s=function(){var e=this,t=e._self._c;return t(e.config.name,e._b({ref:"form",tag:"component",attrs:{mode:e.mode},model:{value:e._value,callback:function(t){e._value=t},expression:"_value"}},"component",e.config.props,!1))},o=[];let l=()=>i.e("chunk-26c5db12").then(i.bind(null,"b28d")),n=()=>i.e("chunk-76d1ec8f").then(i.bind(null,"cf45")),r=()=>i.e("chunk-bbc41c94").then(i.bind(null,"5cb6")),a=()=>i.e("chunk-790652fa").then(i.bind(null,"d158")),c=()=>i.e("chunk-8b173cd0").then(i.bind(null,"0d29")),d=()=>i.e("chunk-c0be42b4").then(i.bind(null,"412b")),u=()=>i.e("chunk-4684e5ce").then(i.bind(null,"f89a")),p=()=>i.e("chunk-2d279333").then(i.bind(null,"4f98")),m=()=>i.e("chunk-ff757d9a").then(i.bind(null,"77aa")),h=()=>i.e("chunk-551d172a").then(i.bind(null,"db9e")),f=()=>i.e("chunk-1b91adc2").then(i.bind(null,"023d")),v=()=>i.e("chunk-2d0f04df").then(i.bind(null,"9c98")),g=()=>i.e("chunk-2d0e4c53").then(i.bind(null,"9248")),b=()=>i.e("chunk-534868ee").then(i.bind(null,"f13b")),y=()=>i.e("chunk-45791fda").then(i.bind(null,"86c3")),_=()=>i.e("chunk-2d0e9937").then(i.bind(null,"8db7")),k=()=>Promise.all([i.e("chunk-4a5f46a6"),i.e("chunk-57672512")]).then(i.bind(null,"918a")),x=()=>Promise.all([i.e("chunk-4a5f46a6"),i.e("chunk-546b6b7a")]).then(i.bind(null,"7ca0"));var S={TextInput:l,NumberInput:n,AmountInput:r,TextareaInput:a,SelectInput:c,MultipleSelect:d,DateTime:u,DateTimeRange:p,UserPicker:y,DeptPicker:b,Description:m,FileUpload:f,ImageUpload:h,MoneyInput:g,Location:v,SignPanel:_,SpanLayout:k,TableList:x},w={name:"FormRender",components:S,props:{mode:{type:String,default:"DESIGN"},value:{default:void 0},config:{type:Object,default:()=>({})}},computed:{_value:{get(){return this.value},set(e){this.$emit("input",e)}}},data(){return{}},methods:{validate(e){this.$refs.form.validate(e)}}},C=w,N=i("2877"),$=Object(N["a"])(C,s,o,!1,null,"495b63a5",null);t["a"]=$.exports},d53d:function(e,t,i){},d63a:function(e,t,i){"use strict";i("875f")},d66d:function(e,t,i){"use strict";i("1372")},dad2:function(e,t,i){"use strict";var s=i("d066"),o=function(e){return{size:e,has:function(){return!1},keys:function(){return{next:function(){return{done:!0}}}}}};e.exports=function(e){var t=s("Set");try{(new t)[e](o(0));try{return(new t)[e](o(-1)),!1}catch(i){return!0}}catch(l){return!1}}},db72:function(e,t,i){},dc19:function(e,t,i){"use strict";var s=i("cb27").has;e.exports=function(e){return s(e),e}},e47a:function(e,t,i){},e5e0:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e._self._c;return t("el-container",{staticStyle:{height:"100%"}},[t("el-header",{staticStyle:{background:"white"}},[t("layout-header",{on:{publish:e.publishProcess,preview:e.preview},model:{value:e.activeSelect,callback:function(t){e.activeSelect=t},expression:"activeSelect"}})],1),t("div",{staticClass:"layout-body"},[t("form-base-setting",{directives:[{name:"show",rawName:"v-show",value:"baseSetting"===e.activeSelect,expression:"activeSelect === 'baseSetting'"}],ref:"baseSetting"}),t("form-design-amis",{directives:[{name:"show",rawName:"v-show",value:"formSetting"===e.activeSelect,expression:"activeSelect === 'formSetting'"}],ref:"formSetting"}),t("process-design",{directives:[{name:"show",rawName:"v-show",value:"processDesign"===e.activeSelect,expression:"activeSelect === 'processDesign'"}],ref:"processDesign"}),t("form-pro-setting",{directives:[{name:"show",rawName:"v-show",value:"proSetting"===e.activeSelect,expression:"activeSelect === 'proSetting'"}],ref:"proSetting"})],1),t("w-dialog",{attrs:{showFooter:!1,title:"设置项检查"},model:{value:e.validVisible,callback:function(t){e.validVisible=t},expression:"validVisible"}},[t("el-steps",{attrs:{"align-center":"",active:e.validStep,"finish-status":"success"}},e._l(e.validOptions,(function(e,i){return t("el-step",{key:i,attrs:{title:e.title,icon:e.icon,status:e.status,description:e.description}})})),1),t("el-result",{attrs:{icon:e.validIcon,title:e.errTitle,subTitle:e.validResult.desc}},[e.validResult.finished?e._e():t("i",{staticClass:"el-icon-loading",staticStyle:{"font-size":"30px"},attrs:{slot:"icon"},slot:"icon"}),e.validResult.errs.length>0?t("div",{staticClass:"err-info",attrs:{slot:"subTitle"},slot:"subTitle"},e._l(e.validResult.errs,(function(e,i){return t("ellipsis",{key:i+"_err",attrs:{"hover-tip":"",content:e}},[t("i",{staticClass:"el-icon-warning-outline",attrs:{slot:"pre"},slot:"pre"})])})),1):e._e(),t("template",{slot:"extra"},[e.validResult.finished?t("el-button",{attrs:{type:"primary",size:"medium"},on:{click:e.doAfter}},[e._v(" "+e._s(e.validResult.action)+" ")]):e._e()],1)],2)],1)],1)},o=[],l=(i("14d9"),function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"header"},[t("el-menu",{staticClass:"el-menu-demo",attrs:{"default-active":e.value,"active-text-color":"#2468f2",mode:"horizontal"},on:{select:e.handleSelect}},[t("el-menu-item",{attrs:{index:"baseSetting"},on:{click:function(t){return e.to("baseSetting")}}},[e._v("① 基础信息")]),t("el-menu-item",{attrs:{index:"formSetting"},on:{click:function(t){return e.to("formSetting")}}},[e._v("② 审批表单")]),t("el-menu-item",{attrs:{index:"processDesign"},on:{click:function(t){return e.to("processDesign")}}},[e._v("③ 审批流程 ")]),t("el-menu-item",{attrs:{index:"proSetting"},on:{click:function(t){return e.to("proSetting")}}},[e._v("④ 扩展设置")])],1),t("div",{staticClass:"publish"},[t("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.publish}},[t("i",{staticClass:"el-icon-s-promotion"}),e._v("发布")])],1),t("div",{staticClass:"back"},[t("el-button",{attrs:{size:"medium",icon:"el-icon-arrow-left",circle:""},on:{click:e.exit}}),t("span",[t("i",{class:e.setup.logo.icon,style:"background:"+e.setup.logo.background}),t("span",[e._v(e._s(e.setup.formName))])])],1)],1),t("el-dialog",{attrs:{title:"请使用手机扫码预览",visible:e.viewCode,width:"300px","close-on-click-modal":!1,center:""},on:{"update:visible":function(t){e.viewCode=t}}},[t("img",{attrs:{src:i("41f4"),width:"250",height:"250"}})])],1)}),n=[],r={name:"LayoutHeader",props:{value:{type:String,default:"baseSetup"}},data(){return{viewCode:!1}},computed:{setup(){return this.$store.state.design}},created(){this.check()},mounted(){console.log(document.body.offsetWidth),document.body.offsetWidth<=970&&this.$msgbox.alert("本设计器未适配中小屏幕，建议您在PC电脑端浏览器进行操作"),this.listener()},methods:{publish(){this.$emit("publish")},preview(){this.$emit("preview"),this.viewCode=!0},valid(){return!!this.$isNotEmpty(this.setup.group)||(this.$message.warning("请选择分组"),this.$router.push("/layout/baseSetup"),!1)},exit(){this.$confirm("未发布的内容将不会被保存，是否直接退出 ?","提示",{confirmButtonText:"退出",cancelButtonText:"取消",type:"warning"}).then(()=>{history.back()})},to(e){this.$emit("input",e)},handleSelect(e,t){console.log(e,t)},listener(){window.onunload=this.closeBefore(),window.onbeforeunload=this.closeBefore()},closeBefore(){return!1},check(){this.$store.state.isEdit}}},a=r,c=(i("264d"),i("2877")),d=Object(c["a"])(a,l,n,!1,null,"45f2aca2",null),u=d.exports,p=i("4e02"),m=function(){var e=this,t=e._self._c;return t("div",{staticClass:"base-setup",on:{click:function(t){e.showIconSelect=!1}}},[t("el-form",{ref:"baseSetting",attrs:{model:e.setup,"label-position":"top","label-width":"80px"}},[t("el-form-item",{attrs:{label:"表单图标"}},[t("el-row",{attrs:{type:"flex"}},[t("i",{class:e.setup.logo.icon,style:"background:"+e.setup.logo.background}),t("span",{staticClass:"change-icon"},[t("span",[t("span",[e._v("选择背景色")]),t("el-color-picker",{attrs:{"show-alpha":"",size:"small",predefine:e.colors},model:{value:e.setup.logo.background,callback:function(t){e.$set(e.setup.logo,"background",t)},expression:"setup.logo.background"}})],1),t("span",[t("span",[e._v("选择图标")]),t("el-popover",{attrs:{placement:"bottom-start",width:"950",trigger:"click"}},[t("div",{staticClass:"icon-select"},e._l(e.icons,(function(i,s){return t("i",{key:s,class:i,on:{click:function(t){e.setup.logo.icon=i}}})})),0),t("i",{class:e.setup.logo.icon,attrs:{slot:"reference"},slot:"reference"})])],1)])])],1),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"表单名称",rules:e.getRule("请输入表单名称"),prop:"formName"}},[t("el-input",{model:{value:e.setup.formName,callback:function(t){e.$set(e.setup,"formName",t)},expression:"setup.formName"}})],1),t("el-form-item",{staticClass:"group",attrs:{label:"所在分组",rules:e.getRule("请选择表单分组"),prop:"groupId"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择分组"},model:{value:e.setup.groupId,callback:function(t){e.$set(e.setup,"groupId",t)},expression:"setup.groupId"}},e._l(e.fromGroup,(function(e,i){return t("el-option",{key:i,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1),t("el-form-item",{attrs:{label:"表单说明"}},[t("el-input",{attrs:{placeholder:"请输入表单说明",type:"textarea","show-word-limit":"",autosize:{minRows:2,maxRows:5},maxlength:"500"},model:{value:e.setup.remark,callback:function(t){e.$set(e.setup,"remark",t)},expression:"setup.remark"}})],1),t("el-form-item",{attrs:{label:"消息通知方式",rules:e.getRule("请选择消息通知方式")}},[t("el-select",{staticStyle:{width:"50%"},attrs:{placeholder:"选择消息通知方式",size:"medium",clearable:"",multiple:""},model:{value:e.setup.settings.notify.types,callback:function(t){e.$set(e.setup.settings.notify,"types",t)},expression:"setup.settings.notify.types"}},e._l(e.notifyTypes,(function(e,i){return t("el-option",{key:i,attrs:{label:e.name,value:e.type}})})),1)],1)],1),t("org-picker",{ref:"orgPicker",attrs:{title:"请选择可以管理此表单的人员",multiple:"",selected:e.select},on:{ok:e.selected}})],1)},h=[],f=i("709c"),v=i("a2c5"),g={name:"FormBaseSetting",components:{OrgPicker:f["a"]},data(){return{nowUserSelect:null,showIconSelect:!1,select:[],newGroup:"",fromGroup:[],notifyTypes:[{type:"APP",name:"应用内通知"},{type:"SMS",name:"短信通知"}],colors:["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"],icons:["el-icon-platform-eleme","el-icon-eleme","el-icon-delete-solid","el-icon-delete","el-icon-s-tools","el-icon-setting","el-icon-user-solid","el-icon-user","el-icon-phone","el-icon-phone-outline","el-icon-more","el-icon-more-outline","el-icon-star-on","el-icon-star-off","el-icon-s-goods","el-icon-goods","el-icon-warning","el-icon-warning-outline","el-icon-question","el-icon-info","el-icon-remove","el-icon-circle-plus","el-icon-success","el-icon-error","el-icon-zoom-in","el-icon-zoom-out","el-icon-remove-outline","el-icon-circle-plus-outline","el-icon-circle-check","el-icon-circle-close","el-icon-s-help","el-icon-help","el-icon-minus","el-icon-plus","el-icon-check","el-icon-close","el-icon-picture","el-icon-picture-outline","el-icon-picture-outline-round","el-icon-upload","el-icon-upload2","el-icon-download","el-icon-camera-solid","el-icon-camera","el-icon-video-camera-solid","el-icon-video-camera","el-icon-message-solid","el-icon-bell","el-icon-s-cooperation","el-icon-s-order","el-icon-s-platform","el-icon-s-fold","el-icon-s-unfold","el-icon-s-operation","el-icon-s-promotion","el-icon-s-home","el-icon-s-release","el-icon-s-ticket","el-icon-s-management","el-icon-s-open","el-icon-s-shop","el-icon-s-marketing","el-icon-s-flag","el-icon-s-comment","el-icon-s-finance","el-icon-s-claim","el-icon-s-custom","el-icon-s-opportunity","el-icon-s-data","el-icon-s-check","el-icon-s-grid","el-icon-menu","el-icon-share","el-icon-video-play","el-icon-refresh","el-icon-refresh-right","el-icon-refresh-left","el-icon-finished","el-icon-sort","el-icon-sort-up","el-icon-sort-down","el-icon-rank","el-icon-view","el-icon-c-scale-to-original","el-icon-date","el-icon-edit","el-icon-edit-outline","el-icon-folder","el-icon-folder-opened","el-icon-folder-add","el-icon-folder-remove","el-icon-folder-delete","el-icon-folder-checked","el-icon-tickets","el-icon-document-remove","el-icon-document-delete","el-icon-document-copy","el-icon-document-checked","el-icon-document","el-icon-document-add","el-icon-printer","el-icon-paperclip","el-icon-takeaway-box","el-icon-search","el-icon-monitor","el-icon-attract","el-icon-mobile","el-icon-scissors","el-icon-umbrella","el-icon-headset","el-icon-brush","el-icon-mouse","el-icon-coordinate","el-icon-magic-stick","el-icon-reading","el-icon-data-line","el-icon-data-board","el-icon-pie-chart","el-icon-data-analysis","el-icon-collection-tag","el-icon-film","el-icon-suitcase","el-icon-suitcase-1","el-icon-receiving","el-icon-collection","el-icon-files","el-icon-notebook-1","el-icon-notebook-2","el-icon-toilet-paper","el-icon-office-building","el-icon-school","el-icon-table-lamp","el-icon-house","el-icon-no-smoking","el-icon-smoking","el-icon-shopping-cart-full","el-icon-shopping-cart-1","el-icon-shopping-cart-2","el-icon-shopping-bag-1","el-icon-shopping-bag-2","el-icon-sold-out","el-icon-sell","el-icon-present","el-icon-box","el-icon-bank-card","el-icon-money","el-icon-coin","el-icon-wallet","el-icon-discount","el-icon-price-tag","el-icon-news","el-icon-guide","el-icon-male","el-icon-female","el-icon-thumb","el-icon-cpu","el-icon-link","el-icon-connection","el-icon-open","el-icon-turn-off","el-icon-set-up","el-icon-chat-round","el-icon-chat-line-round","el-icon-chat-square","el-icon-chat-dot-round","el-icon-chat-dot-square","el-icon-chat-line-square","el-icon-message","el-icon-postcard","el-icon-position","el-icon-turn-off-microphone","el-icon-microphone","el-icon-close-notification","el-icon-bangzhu","el-icon-time","el-icon-odometer","el-icon-crop","el-icon-aim","el-icon-switch-button","el-icon-full-screen","el-icon-copy-document","el-icon-mic","el-icon-stopwatch","el-icon-medal-1","el-icon-medal","el-icon-trophy","el-icon-trophy-1","el-icon-first-aid-kit","el-icon-discover","el-icon-place","el-icon-location","el-icon-location-outline","el-icon-location-information","el-icon-add-location","el-icon-delete-location","el-icon-map-location","el-icon-alarm-clock","el-icon-timer","el-icon-watch-1","el-icon-watch","el-icon-lock","el-icon-unlock","el-icon-key","el-icon-service","el-icon-mobile-phone","el-icon-bicycle","el-icon-truck","el-icon-ship","el-icon-basketball","el-icon-football","el-icon-soccer","el-icon-baseball","el-icon-wind-power","el-icon-light-rain","el-icon-lightning","el-icon-heavy-rain","el-icon-sunrise","el-icon-sunrise-1","el-icon-sunset","el-icon-sunny","el-icon-cloudy","el-icon-partly-cloudy","el-icon-cloudy-and-sunny","el-icon-moon","el-icon-moon-night","el-icon-dish","el-icon-dish-1","el-icon-food","el-icon-chicken","el-icon-fork-spoon","el-icon-knife-fork","el-icon-burger","el-icon-tableware","el-icon-sugar","el-icon-dessert","el-icon-ice-cream","el-icon-hot-water","el-icon-water-cup","el-icon-coffee-cup","el-icon-cold-drink","el-icon-goblet","el-icon-goblet-full","el-icon-goblet-square","el-icon-goblet-square-full","el-icon-refrigerator","el-icon-grape","el-icon-watermelon","el-icon-cherry","el-icon-apple","el-icon-pear","el-icon-orange","el-icon-coffee","el-icon-ice-tea","el-icon-ice-drink","el-icon-milk-tea","el-icon-potato-strips","el-icon-lollipop","el-icon-ice-cream-square","el-icon-ice-cream-round"],rules:{formName:[{}],groupId:[]}}},computed:{setup(){return this.$store.state.design}},created(){this.loadIconfont()},mounted(){this.getGroups()},methods:{getRule(e){return[{required:!0,message:e,trigger:"blur"}]},loadIconfont(){v&&v.id&&v.glyphs.forEach(e=>{})},getGroups(){Object(p["b"])().then(e=>{this.fromGroup=e.data}).catch(e=>this.$message.error("获取分组异常"))},addGroup(){""!==this.newGroup.trim()&&Object(p["f"])({name:this.newGroup.trim()},"post").then(e=>{this.$message.success(e.data),this.getGroups()}).catch(e=>this.$message.error(e.response.data))},selected(e){this.$set(this.setup.settings,this.nowUserSelect,e)},selectUser(e){this.select=this.setup.settings[e],this.nowUserSelect=e,this.$refs.orgPicker.show()},validate(){this.$refs.baseSetting.validate();let e=[];return this.$isNotEmpty(this.setup.formName)||e.push("表单名称未设置"),this.$isNotEmpty(this.setup.groupId)||e.push("表单分组未设置"),0===this.setup.settings.notify.types.length&&e.push("审批消息通知方式未设置"),e}}},b=g,y=(i("6cd9"),Object(c["a"])(b,m,h,!1,null,"1f9eecea",null)),_=y.exports,k=function(){var e=this,t=e._self._c;return t("el-container",{staticClass:"form-container",staticStyle:{height:"calc(100vh - 65px)"}},[t("iframe",{staticClass:"amis-frame",attrs:{src:e.frameURL}})])},x=[],S=i("b76a"),w=i.n(S),C=i("2b36"),N=i("d16b"),$=function(){var e=this,t=e._self._c;return t("div",["SpanLayout"!==e.form.name?t("el-form",{attrs:{"label-width":"90px"}},[t("el-form-item",{attrs:{label:"表单名称"}},[t("el-input",{attrs:{size:"small",clearable:""},model:{value:e.form.title,callback:function(t){e.$set(e.form,"title",t)},expression:"form.title"}})],1),t(e.form.name,{tag:"component",model:{value:e.form.props,callback:function(t){e.$set(e.form,"props",t)},expression:"form.props"}}),t("el-form-item",{attrs:{label:"必填项"}},[t("el-switch",{model:{value:e.form.props.required,callback:function(t){e.$set(e.form.props,"required",t)},expression:"form.props.required"}})],1),t("el-form-item",{attrs:{label:"可打印"}},[t("el-switch",{model:{value:e.form.props.enablePrint,callback:function(t){e.$set(e.form.props,"enablePrint",t)},expression:"form.props.enablePrint"}})],1)],1):t("el-empty",{attrs:{description:"当前组件不支持配置"}})],1)},O=[],I=function(){var e=this,t=e._self._c;return t("el-form-item",{attrs:{label:"提示文字"}},[t("el-input",{attrs:{size:"small",placeholder:"请设置提示语"},model:{value:e.value.placeholder,callback:function(t){e.$set(e.value,"placeholder",t)},expression:"value.placeholder"}})],1)},E=[],T={name:"TextInput",components:{},props:{value:{type:Object,default:()=>({})}},data(){return{}},methods:{}},P=T,R=Object(c["a"])(P,I,E,!1,null,"5a2e2d58",null),L=R.exports,z=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"提示文字"}},[t("el-input",{attrs:{size:"small",placeholder:"请设置提示语"},model:{value:e.value.placeholder,callback:function(t){e.$set(e.value,"placeholder",t)},expression:"value.placeholder"}})],1)],1)},D=[],A={name:"NumberInput",components:{},props:{value:{type:Object,default:()=>({})}},data(){return{}},methods:{}},U=A,j=Object(c["a"])(U,z,D,!1,null,"bb4e78be",null),F=j.exports,M=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"提示文字"}},[t("el-input",{attrs:{size:"small",placeholder:"请设置提示语"},model:{value:e.value.placeholder,callback:function(t){e.$set(e.value,"placeholder",t)},expression:"value.placeholder"}})],1),t("el-form-item",{attrs:{label:"保留小数"}},[t("el-input-number",{attrs:{"controls-position":"right",precision:0,max:3,min:0,size:"small",placeholder:"小数位数"},model:{value:e.value.precision,callback:function(t){e.$set(e.value,"precision",t)},expression:"value.precision"}}),e._v(" 位 ")],1),t("el-form-item",{attrs:{label:"展示大写"}},[t("el-switch",{model:{value:e.value.showChinese,callback:function(t){e.$set(e.value,"showChinese",t)},expression:"value.showChinese"}})],1)],1)},B=[],V={name:"AmountInputConfig",components:{},props:{value:{type:Object,default:()=>({})}},data(){return{}},methods:{}},G=V,q=Object(c["a"])(G,M,B,!1,null,"5a46fff2",null),H=q.exports,J=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"提示文字"}},[t("el-input",{attrs:{size:"small",placeholder:"请设置提示语"},model:{value:e.value.placeholder,callback:function(t){e.$set(e.value,"placeholder",t)},expression:"value.placeholder"}})],1)],1)},Y=[],W={name:"TextareaInput",components:{},props:{value:{type:Object,default:()=>({})}},data(){return{}},methods:{}},K=W,X=Object(c["a"])(K,J,Y,!1,null,"61204883",null),Z=X.exports,Q=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"提示文字"}},[t("el-input",{attrs:{size:"small",placeholder:"请设置提示语"},model:{value:e.value.placeholder,callback:function(t){e.$set(e.value,"placeholder",t)},expression:"value.placeholder"}})],1),t("el-form",{attrs:{"label-position":"top"}},[t("el-form-item",{staticClass:"options",attrs:{label:"选项设置"}},[t("div",{staticClass:"option-item-label",attrs:{slot:"label"},slot:"label"},[t("span",[e._v("选项设置")]),t("el-button",{attrs:{icon:"el-icon-plus",type:"text",size:"mini"},on:{click:function(t){return e.value.options.push("新选项")}}},[e._v("新增选项")])],1),t("draggable",{attrs:{list:e.value.options,group:"option",handler:".el-icon-rank",options:e.dragOption}},e._l(e.value.options,(function(i,s){return t("div",{key:s,staticClass:"option-item"},[t("i",{staticClass:"el-icon-rank"}),t("el-input",{attrs:{size:"medium",placeholder:"请设置选项值",clearable:""},model:{value:e.value.options[s],callback:function(t){e.$set(e.value.options,s,t)},expression:"value.options[index]"}},[t("el-button",{attrs:{slot:"append",icon:"el-icon-delete",type:"danger",size:"medium"},on:{click:function(t){return e.value.options.splice(s,1)}},slot:"append"})],1)],1)})),0)],1)],1),t("el-form-item",{attrs:{label:"选项展开"}},[t("el-switch",{model:{value:e.value.expanding,callback:function(t){e.$set(e.value,"expanding",t)},expression:"value.expanding"}})],1)],1)},ee=[],te={name:"SelectInputConfig",components:{draggable:w.a},props:{value:{type:Object,default:()=>({})}},data(){return{dragOption:{animation:300,sort:!0}}},methods:{}},ie=te,se=(i("510e"),Object(c["a"])(ie,Q,ee,!1,null,"b65a1d60",null)),oe=se.exports,le=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"提示文字"}},[t("el-input",{attrs:{size:"small",placeholder:"请设置日期提示"},model:{value:e.value.placeholder,callback:function(t){e.$set(e.value,"placeholder",t)},expression:"value.placeholder"}})],1),t("el-form-item",{attrs:{label:"日期格式"}},[t("el-select",{attrs:{size:"small"},model:{value:e.value.format,callback:function(t){e.$set(e.value,"format",t)},expression:"value.format"}},[t("el-option",{attrs:{value:"yyyy",label:"年"}}),t("el-option",{attrs:{value:"yyyy-MM",label:"年-月"}}),t("el-option",{attrs:{value:"yyyy-MM-dd",label:"年-月-日"}}),t("el-option",{attrs:{value:"yyyy-MM-dd HH:mm",label:"年-月-日 时:分"}})],1)],1)],1)},ne=[],re={name:"DateTime",components:{},props:{value:{type:Object,default:()=>({})}},data(){return{}},methods:{}},ae=re,ce=Object(c["a"])(ae,le,ne,!1,null,"021277c8",null),de=ce.exports,ue=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"提示文字"}},[t("el-input",{attrs:{size:"small",placeholder:"开始日期提示"},model:{value:e.value.placeholder[0],callback:function(t){e.$set(e.value.placeholder,0,t)},expression:"value.placeholder[0]"}}),t("el-input",{attrs:{size:"small",placeholder:"结束日期提示"},model:{value:e.value.placeholder[1],callback:function(t){e.$set(e.value.placeholder,1,t)},expression:"value.placeholder[1]"}})],1),t("el-form-item",{attrs:{label:"日期格式"}},[t("el-select",{attrs:{size:"small"},model:{value:e.value.format,callback:function(t){e.$set(e.value,"format",t)},expression:"value.format"}},[t("el-option",{attrs:{value:"yyyy",label:"年"}}),t("el-option",{attrs:{value:"yyyy-MM",label:"年-月"}}),t("el-option",{attrs:{value:"yyyy-MM-dd",label:"年-月-日"}}),t("el-option",{attrs:{value:"yyyy-MM-dd HH:mm",label:"年-月-日 时:分"}})],1)],1),t("el-form-item",{attrs:{label:"展示时长"}},[t("el-switch",{model:{value:e.value.showLength,callback:function(t){e.$set(e.value,"showLength",t)},expression:"value.showLength"}})],1)],1)},pe=[],me={name:"DateTimeRangeConfig",components:{},props:{value:{type:Object,default:()=>({})}},data(){return{}},methods:{}},he=me,fe=Object(c["a"])(he,ue,pe,!1,null,"3719ad92",null),ve=fe.exports,ge=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"提示文字"}},[t("el-input",{attrs:{size:"small",placeholder:"请设置提示语"},model:{value:e.value.placeholder,callback:function(t){e.$set(e.value,"placeholder",t)},expression:"value.placeholder"}})],1),t("el-form-item",{attrs:{label:"数量限制"}},[t("tip",{attrs:{slot:"label",content:"限制最大上传图片数量（为0则不限制）"},slot:"label"},[e._v("数量限制")]),t("el-input-number",{staticClass:"max-fill",attrs:{"controls-position":"right",precision:0,size:"small",placeholder:"最多上传几张图片"},model:{value:e.value.maxNumber,callback:function(t){e.$set(e.value,"maxNumber",t)},expression:"value.maxNumber"}})],1),t("el-form-item",{attrs:{label:"大小限制"}},[t("tip",{attrs:{slot:"label",content:"限制单个图片最大大小-MB（为0则不限制）"},slot:"label"},[e._v("大小限制")]),t("el-input-number",{staticClass:"max-fill",attrs:{"controls-position":"right",precision:1,size:"small",placeholder:"单个文件最大大小"},model:{value:e.value.maxSize,callback:function(t){e.$set(e.value,"maxSize",t)},expression:"value.maxSize"}})],1),t("el-form-item",{attrs:{label:"图片压缩"}},[t("el-switch",{model:{value:e.value.enableZip,callback:function(t){e.$set(e.value,"enableZip",t)},expression:"value.enableZip"}})],1)],1)},be=[],ye={name:"ImageUploadConfig",components:{},props:{value:{type:Object,default:()=>({})}},data(){return{}},methods:{}},_e=ye,ke=(i("b466"),Object(c["a"])(_e,ge,be,!1,null,"a6aa5262",null)),xe=ke.exports,Se=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"提示文字"}},[t("el-input",{attrs:{size:"small",placeholder:"请设置提示语"},model:{value:e.value.placeholder,callback:function(t){e.$set(e.value,"placeholder",t)},expression:"value.placeholder"}})],1),t("el-form-item",{attrs:{label:"数量限制"}},[t("tip",{attrs:{slot:"label",content:"限制最大上传图片数量（为0则不限制）"},slot:"label"},[e._v("数量限制")]),t("el-input-number",{staticClass:"max-fill",attrs:{"controls-position":"right",precision:0,size:"small",placeholder:"最多上传几张图片"},model:{value:e.value.maxNumber,callback:function(t){e.$set(e.value,"maxNumber",t)},expression:"value.maxNumber"}})],1),t("el-form-item",{attrs:{label:"大小限制"}},[t("tip",{attrs:{slot:"label",content:"限制单个文件最大大小-MB（为0则不限制）"},slot:"label"},[e._v("大小限制")]),t("el-input-number",{staticClass:"max-fill",attrs:{"controls-position":"right",precision:1,size:"small",placeholder:"单个文件最大大小"},model:{value:e.value.maxSize,callback:function(t){e.$set(e.value,"maxSize",t)},expression:"value.maxSize"}})],1),t("el-form-item",{attrs:{label:"类型限制"}},[t("tip",{attrs:{slot:"label",content:"限制上传文件的后缀类型"},slot:"label"},[e._v("类型限制")]),t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",multiple:"",filterable:"","allow-create":"","default-first-option":"",clearable:"",placeholder:"允许上传文件的后缀格式，可设置多种"},model:{value:e.value.fileTypes,callback:function(t){e.$set(e.value,"fileTypes",t)},expression:"value.fileTypes"}})],1),t("el-form-item",{attrs:{label:"不可下载"}},[t("el-switch",{model:{value:e.value.onlyRead,callback:function(t){e.$set(e.value,"onlyRead",t)},expression:"value.onlyRead"}})],1)],1)},we=[],Ce={name:"FileUploadConfig",components:{},props:{value:{type:Object,default:()=>({})}},data(){return{}},methods:{}},Ne=Ce,$e=(i("7ce0"),Object(c["a"])(Ne,Se,we,!1,null,"4860ea76",null)),Oe=$e.exports,Ie=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"提示内容"}},[t("el-input",{attrs:{size:"small",placeholder:"请设置提示内容"},model:{value:e.value.placeholder,callback:function(t){e.$set(e.value,"placeholder",t)},expression:"value.placeholder"}})],1),t("el-form-item",{attrs:{label:"文字颜色"}},[t("el-color-picker",{attrs:{size:"medium"},model:{value:e.value.color,callback:function(t){e.$set(e.value,"color",t)},expression:"value.color"}})],1)],1)},Ee=[],Te={name:"Description",components:{},props:{value:{type:Object,default:()=>({})}},data(){return{}},methods:{}},Pe=Te,Re=Object(c["a"])(Pe,Ie,Ee,!1,null,"5dd903f7",null),Le=Re.exports,ze=function(){var e=this,t=e._self._c;return t("div")},De=[],Ae={name:"MoneyInput",components:{},data(){return{}},methods:{}},Ue=Ae,je=Object(c["a"])(Ue,ze,De,!1,null,"6886da1c",null),Fe=je.exports,Me=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"提示文字"}},[t("el-input",{attrs:{size:"small",placeholder:"请设置提示语"},model:{value:e.value.placeholder,callback:function(t){e.$set(e.value,"placeholder",t)},expression:"value.placeholder"}})],1),t("el-form-item",{attrs:{label:"是否多选"}},[t("el-switch",{model:{value:e.value.multiple,callback:function(t){e.$set(e.value,"multiple",t)},expression:"value.multiple"}})],1)],1)},Be=[],Ve={name:"OrgPicker",components:{},props:{value:{type:Object,default:()=>({})}},data(){return{}},methods:{}},Ge=Ve,qe=Object(c["a"])(Ge,Me,Be,!1,null,"def7cafc",null),He=qe.exports,Je=function(){var e=this,t=e._self._c;return t("div",[t("el-form-item",{attrs:{label:"提示文字"}},[t("el-input",{attrs:{size:"small",placeholder:"提醒添加记录的提示"},model:{value:e.value.placeholder,callback:function(t){e.$set(e.value,"placeholder",t)},expression:"value.placeholder"}})],1),t("el-form-item",{attrs:{label:"最大行数"}},[t("tip",{attrs:{slot:"label",content:"允许添加多少条记录（为0则不限制）"},slot:"label"},[e._v("最大行数")]),t("el-input-number",{attrs:{"controls-position":"right",precision:0,max:100,min:0,size:"small",placeholder:"限制条数"},model:{value:e.value.maxSize,callback:function(t){e.$set(e.value,"maxSize",t)},expression:"value.maxSize"}})],1),t("el-form-item",{attrs:{label:"布局方式"}},[t("el-radio",{attrs:{name:"layout",label:!0},model:{value:e.value.rowLayout,callback:function(t){e.$set(e.value,"rowLayout",t)},expression:"value.rowLayout"}},[e._v("按表格")]),t("el-radio",{attrs:{name:"layout",label:!1},model:{value:e.value.rowLayout,callback:function(t){e.$set(e.value,"rowLayout",t)},expression:"value.rowLayout"}},[e._v("按表单")])],1),t("el-form-item",{attrs:{label:"展示合计"}},[t("el-switch",{model:{value:e.value.showSummary,callback:function(t){e.$set(e.value,"showSummary",t)},expression:"value.showSummary"}}),e.value.showSummary?t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",multiple:"",clearable:"",placeholder:"请选择合计项"},model:{value:e.value.summaryColumns,callback:function(t){e.$set(e.value,"summaryColumns",t)},expression:"value.summaryColumns"}},e._l(e.columns,(function(e){return t("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})})),1):e._e()],1),t("el-form-item",{attrs:{label:"展示边框"}},[t("el-switch",{model:{value:e.value.showBorder,callback:function(t){e.$set(e.value,"showBorder",t)},expression:"value.showBorder"}})],1)],1)},Ye=[],We={name:"TableListConfig",components:{},props:{value:{type:Object,default:()=>({})}},computed:{columns(){return this.value.columns.filter(e=>"Number"===e.valueType)}},data(){return{}},methods:{}},Ke=We,Xe=Object(c["a"])(Ke,Je,Ye,!1,null,"5bbee00a",null),Ze=Xe.exports,Qe={name:"FormComponentConfig",components:{TextInput:L,NumberInput:F,AmountInput:H,TextareaInput:Z,SelectInput:oe,MultipleSelect:oe,DateTime:de,DateTimeRange:ve,ImageUpload:xe,FileUpload:Oe,Description:Le,MoneyInput:Fe,DeptPicker:He,UserPicker:He,TableList:Ze},props:{},computed:{form(){return this.$store.state.selectFormItem}},data(){return{}},methods:{}},et=Qe,tt=Object(c["a"])(et,$,O,!1,null,"65a15610",null),it=tt.exports,st=i("8032"),ot={name:"FormDesignAmis",components:{draggable:w.a,FormComponentConfig:it,FormDesignRender:N["a"],FormRender:C["a"]},data(){return{formType:null,loaded:!1}},mounted(){this.loaded=!0},computed:{setup(){return this.$store.state.design},frameURL(){const e=window.location.pathname.replace(/\/process-editor\/?/,""),{formId:t}=this.$store.state.design;return t&&this.loaded?`${e}/amis-editor/#/edit/form/${t}`:""}},methods:{validate(){let e=[];return e}}},lt=ot,nt=(i("b31a"),Object(c["a"])(lt,k,x,!1,null,"5d464096",null)),rt=nt.exports,at=function(){var e=this,t=e._self._c;return t("el-main",[t("div",{staticClass:"scale"},[t("el-button",{attrs:{icon:"el-icon-plus",size:"small",disabled:e.scale>=150,circle:""},on:{click:function(t){e.scale+=10}}}),t("span",[e._v(e._s(e.scale)+"%")]),t("el-button",{attrs:{icon:"el-icon-minus",size:"small",disabled:e.scale<=40,circle:""},on:{click:function(t){e.scale-=10}}})],1),t("div",{staticClass:"design",style:"transform: scale("+e.scale/100+");"},[t("process-tree",{ref:"process-tree",on:{selectedNode:e.nodeSelected}})],1),t("el-drawer",{attrs:{title:e.selectedNode.name,visible:e.showConfig,"modal-append-to-body":!1,size:"CONDITION"===e.selectedNode.type?"600px":"500px",direction:"rtl",modal:!1,"destroy-on-close":""},on:{"update:visible":function(t){e.showConfig=t}}},[t("div",{attrs:{slot:"title"},slot:"title"},[t("el-input",{directives:[{name:"show",rawName:"v-show",value:e.showInput,expression:"showInput"}],staticStyle:{width:"300px"},attrs:{size:"medium"},on:{blur:function(t){e.showInput=!1}},model:{value:e.selectedNode.name,callback:function(t){e.$set(e.selectedNode,"name",t)},expression:"selectedNode.name"}}),t("el-link",{directives:[{name:"show",rawName:"v-show",value:!e.showInput,expression:"!showInput"}],staticStyle:{"font-size":"medium"},on:{click:function(t){e.showInput=!0}}},[t("i",{staticClass:"el-icon-edit",staticStyle:{"margin-right":"10px"}}),e._v(" "+e._s(e.selectedNode.name)+" ")])],1),t("div",{staticClass:"node-config-content"},[t("node-config")],1)])],1)},ct=[],dt=function(){var e=this,t=e._self._c;return t("node",{attrs:{title:e.config.name,"show-error":e.showError,content:e.content,"error-info":e.errorInfo,placeholder:"请设置审批人","header-bgc":"#ff943e","header-icon":"el-icon-s-check"},on:{selected:function(t){return e.$emit("selected")},delNode:function(t){return e.$emit("delNode")},insertNode:t=>e.$emit("insertNode",t)}})},ut=[],pt=(i("5b81"),function(){var e=this,t=e._self._c;return t("div",{class:{node:!0,root:e.isRoot||!e.show,"node-error-state":e.showError}},[e.show?t("div",{class:{"node-body":!0,error:e.showError},on:{click:function(t){return e.$emit("selected")}}},[t("div",[t("div",{staticClass:"node-body-header",style:{"background-color":e.headerBgc}},[""!==(e.headerIcon||"")?t("i",{class:e.headerIcon,staticStyle:{"margin-right":"5px"}}):e._e(),t("ellipsis",{staticClass:"name",attrs:{"hover-tip":"",content:e.title}}),e.isRoot?e._e():t("i",{staticClass:"el-icon-close",staticStyle:{float:"right"},on:{click:function(t){return e.$emit("delNode")}}})],1),t("div",{staticClass:"node-body-content"},[e.leftIcon?t("i",{class:e.leftIcon}):e._e(),""===(e.content||"").trim()?t("span",{staticClass:"placeholder"},[e._v(e._s(e.placeholder))]):t("ellipsis",{attrs:{row:3,content:e.content}}),t("i",{staticClass:"el-icon-arrow-right"})],1),e.showError?t("div",{staticClass:"node-error"},[t("el-tooltip",{attrs:{effect:"dark",content:e.errorInfo,placement:"top-start"}},[t("i",{staticClass:"el-icon-warning-outline"})])],1):e._e()])]):e._e(),t("div",{staticClass:"node-footer"},[t("div",{staticClass:"btn"},[t("insert-button",{on:{insertNode:t=>e.$emit("insertNode",t)}})],1)])])}),mt=[],ht=function(){var e=this,t=e._self._c;return t("el-popover",{attrs:{placement:"bottom-start",title:"添加流程节点",width:"350",trigger:"click"}},[t("div",{staticClass:"node-select"},[t("div",{on:{click:e.addApprovalNode}},[t("i",{staticClass:"el-icon-s-check",staticStyle:{color:"rgb(255, 148, 62)"}}),t("span",[e._v("审批人")])]),t("div",{on:{click:e.addCcNode}},[t("i",{staticClass:"el-icon-s-promotion",staticStyle:{color:"rgb(50, 150, 250)"}}),t("span",[e._v("抄送人")])]),t("div",{on:{click:e.addConditionsNode}},[t("i",{staticClass:"el-icon-share",staticStyle:{color:"rgb(21, 188, 131)"}}),t("span",[e._v("条件分支")])]),t("div",{on:{click:e.addConcurrentsNode}},[t("i",{staticClass:"el-icon-s-operation",staticStyle:{color:"#718dff"}}),t("span",[e._v("并行分支")])]),t("div",{on:{click:e.addDelayNode}},[t("i",{staticClass:"el-icon-time",staticStyle:{color:"#f25643"}}),t("span",[e._v("延迟等待")])]),t("div",{on:{click:e.addTriggerNode}},[t("i",{staticClass:"el-icon-set-up",staticStyle:{color:"#15BC83"}}),t("span",[e._v("触发器")])])]),t("el-button",{staticClass:"insert-btn",attrs:{slot:"reference",icon:"el-icon-plus",type:"primary",size:"small",circle:""},slot:"reference"})],1)},ft=[],vt={name:"InsertButton",components:{},data(){return{}},computed:{selectedNode(){this.$store.state.selectedNode}},methods:{addApprovalNode(){this.$emit("insertNode","APPROVAL")},addCcNode(){this.$emit("insertNode","CC")},addDelayNode(){this.$emit("insertNode","DELAY")},addConditionsNode(){this.$emit("insertNode","CONDITIONS")},addConcurrentsNode(){this.$emit("insertNode","CONCURRENTS")},addTriggerNode(){this.$emit("insertNode","TRIGGER")}}},gt=vt,bt=(i("673a"),Object(c["a"])(gt,ht,ft,!1,null,"0c532139",null)),yt=bt.exports,_t={name:"Node",components:{InsertButton:yt},props:{isRoot:{type:Boolean,default:!1},show:{type:Boolean,default:!0},content:{type:String,default:""},title:{type:String,default:"标题"},placeholder:{type:String,default:"请设置"},leftIcon:{type:String,default:void 0},headerIcon:{type:String,default:""},headerBgc:{type:String,default:"#576a95"},showError:{type:Boolean,default:!1},errorInfo:{type:String,default:"无信息"}},data(){return{}},methods:{}},kt=_t,xt=(i("c8be"),Object(c["a"])(kt,pt,mt,!1,null,"31783cce",null)),St=xt.exports,wt={name:"ApprovalNode",props:{config:{type:Object,default:()=>({})}},components:{Node:St},data(){return{showError:!1,errorInfo:""}},computed:{content(){const e=this.config.props;switch(e.assignedType){case"ASSIGN_USER":if(e.assignedUser.length>0){let t=[];return e.assignedUser.forEach(e=>t.push(e.name)),String(t).replaceAll(",","、")}return"请指定审批人";case"SELF":return"发起人自己";case"SELF_SELECT":return e.selfSelect.multiple?"发起人自选多人":"发起人自选一人";case"LEADER_TOP":return"多级主管依次审批";case"LEADER":return e.leader.level>1?"发起人的第 "+e.leader.level+" 级主管":"发起人的直接主管";case"FORM_USER":if(e.formUser&&""!==e.formUser){let t=this.getFormItemById(e.formUser);return t&&t.title?`表单（${t.title}）内的人员`:"该表单已被移除😥"}return"表单内联系人（未选择）";case"ROLE":if(e.role.length>0){let t=[];return e.role.forEach(e=>t.push(e.name)),String(t).replaceAll(",","、")}return"指定角色（未设置）";default:return"未知设置项😥"}}},methods:{getFormItemById(e){return this.$store.state.design.formItems.find(t=>t.id===e)},validate(e){try{return this.showError=!this["validate_"+this.config.props.assignedType](e)}catch(t){return!0}},validate_ASSIGN_USER(e){return this.config.props.assignedUser.length>0||(this.errorInfo="请指定审批人员",e.push(this.config.name+" 未指定审批人员"),!1)},validate_SELF_SELECT(e){return!0},validate_LEADER_TOP(e){return!0},validate_LEADER(e){return!0},validate_ROLE(e){return!(this.config.props.role.length<=0)||(this.errorInfo="请指定负责审批的系统角色",e.push(this.config.name+" 未指定审批角色"),!1)},validate_SELF(e){return!0},validate_FORM_USER(e){return""!==this.config.props.formUser||(this.errorInfo="请指定表单中的人员组件",e.push(this.config.name+" 审批人为表单中人员，但未指定"),!1)},validate_REFUSE(e){return!0}}},Ct=wt,Nt=Object(c["a"])(Ct,dt,ut,!1,null,"7af887e1",null),$t=Nt.exports,Ot=function(){var e=this,t=e._self._c;return t("node",{attrs:{title:e.config.name,"show-error":e.showError,content:e.content,"error-info":e.errorInfo,placeholder:"请设置抄送人","header-bgc":"#3296fa","header-icon":"el-icon-s-promotion"},on:{selected:function(t){return e.$emit("selected")},delNode:function(t){return e.$emit("delNode")},insertNode:t=>e.$emit("insertNode",t)}})},It=[],Et={name:"CcNode",props:{config:{type:Object,default:()=>({})}},components:{Node:St},data(){return{showError:!1,errorInfo:""}},computed:{content(){if(this.config.props.shouldAdd)return"由发起人指定";if(this.config.props.assignedUser.length>0){let e=[];return this.config.props.assignedUser.forEach(t=>e.push(t.name)),String(e).replaceAll(",","、")}return null}},methods:{validate(e){return this.showError=!1,this.config.props.shouldAdd?this.showError=!1:0===this.config.props.assignedUser.length&&(this.showError=!0,this.errorInfo="请选择需要抄送的人员"),this.showError&&e.push(`抄送节点 ${this.config.name} 未设置抄送人`),!this.showError}}},Tt=Et,Pt=Object(c["a"])(Tt,Ot,It,!1,null,"b2b462ee",null),Rt=Pt.exports,Lt=function(){var e=this,t=e._self._c;return t("div",{staticClass:"node"},[t("div",{staticClass:"node-body",on:{click:function(t){return e.$emit("selected")}}},[e.level>1?t("div",{staticClass:"node-body-left",on:{click:function(t){return t.stopPropagation(),e.$emit("leftMove")}}},[t("i",{staticClass:"el-icon-arrow-left"})]):e._e(),t("div",{staticClass:"node-body-main"},[t("div",{staticClass:"node-body-main-header"},[t("span",{staticClass:"title"},[t("i",{staticClass:"el-icon-s-operation"}),t("ellipsis",{staticClass:"name",attrs:{"hover-tip":"",content:e.config.name?e.config.name:"并行任务"+e.level}})],1),t("span",{staticClass:"option"},[t("el-tooltip",{attrs:{effect:"dark",content:"复制分支",placement:"top"}},[t("i",{staticClass:"el-icon-copy-document",on:{click:function(t){return e.$emit("copy")}}})]),t("i",{staticClass:"el-icon-close",on:{click:function(t){return t.stopPropagation(),e.$emit("delNode")}}})],1)]),e._m(0)]),e.level<e.size?t("div",{staticClass:"node-body-right",on:{click:function(t){return t.stopPropagation(),e.$emit("rightMove")}}},[t("i",{staticClass:"el-icon-arrow-right"})]):e._e()]),t("div",{staticClass:"node-footer"},[t("div",{staticClass:"btn"},[t("insert-button",{on:{insertNode:t=>e.$emit("insertNode",t)}})],1)])])},zt=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"node-body-main-content"},[t("span",[e._v("并行任务（同时进行）")])])}],Dt={name:"ConcurrentNode",components:{InsertButton:yt},props:{config:{type:Object,default:()=>({})},level:{type:Number,default:1},size:{type:Number,default:0}},data(){return{}},methods:{}},At=Dt,Ut=(i("770c"),Object(c["a"])(At,Lt,zt,!1,null,"6aba52c7",null)),jt=Ut.exports,Ft=function(){var e=this,t=e._self._c;return t("div",{class:{node:!0,"node-error-state":e.showError}},[t("div",{class:{"node-body":!0,error:e.showError}},[e.level>1?t("div",{staticClass:"node-body-left",on:{click:function(t){return e.$emit("leftMove")}}},[t("i",{staticClass:"el-icon-arrow-left"})]):e._e(),t("div",{staticClass:"node-body-main",on:{click:function(t){return e.$emit("selected")}}},[t("div",{staticClass:"node-body-main-header"},[t("ellipsis",{staticClass:"title",attrs:{"hover-tip":"",content:e.config.name?e.config.name:"条件"+e.level}}),t("span",{staticClass:"level"},[e._v("优先级"+e._s(e.level))]),t("span",{staticClass:"option"},[t("el-tooltip",{attrs:{effect:"dark",content:"复制条件",placement:"top"}},[t("i",{staticClass:"el-icon-copy-document",on:{click:function(t){return t.stopPropagation(),e.$emit("copy")}}})]),t("i",{staticClass:"el-icon-close",on:{click:function(t){return t.stopPropagation(),e.$emit("delNode")}}})],1)],1),t("div",{staticClass:"node-body-main-content"},[""===(e.content||"").trim()?t("span",{staticClass:"placeholder"},[e._v(e._s(e.placeholder))]):t("ellipsis",{attrs:{hoverTip:"",row:4,content:e.content}})],1)]),e.level<e.size?t("div",{staticClass:"node-body-right",on:{click:function(t){return e.$emit("rightMove")}}},[t("i",{staticClass:"el-icon-arrow-right"})]):e._e(),e.showError?t("div",{staticClass:"node-error"},[t("el-tooltip",{attrs:{effect:"dark",content:e.errorInfo,placement:"top-start"}},[t("i",{staticClass:"el-icon-warning-outline"})])],1):e._e()]),t("div",{staticClass:"node-footer"},[t("div",{staticClass:"btn"},[t("insert-button",{on:{insertNode:t=>e.$emit("insertNode",t)}})],1)])])},Mt=[];const Bt=["A","B","C","D","E","F","G","H","I","J"];var Vt={name:"ConditionNode",components:{InsertButton:yt},props:{config:{type:Object,default:()=>({})},level:{type:Number,default:1},size:{type:Number,default:0}},data(){return{ValueType:st["a"],groupNames:Bt,placeholder:"请设置条件",errorInfo:"",showError:!1}},computed:{content(){const e=this.config.props.groups;let t=[];return e.forEach(e=>{let i=[];e.conditions.forEach(e=>{let t="";switch(e.valueType){case st["a"].dept:case st["a"].user:t=`${e.title}属于[${String(e.value.map(e=>e.name)).replaceAll(",",". ")}]之一`;break;case st["a"].number:case st["a"].string:t=this.getOrdinaryConditionContent(e);break}i.push(t)});let s=String(i).replaceAll(",",i.length>1?"AND"===e.groupType?") 且 (":") 或 (":"AND"===e.groupType?" 且 ":" 或 ");t.push(i.length>1?`(${s})`:s)}),String(t).replaceAll(",","AND"===this.config.props.groupsType?" 且 ":" 或 ")}},methods:{getDefault(e,t){return e&&""!==e?e:t},getOrdinaryConditionContent(e){switch(e.compare){case"IN":return`${e.title}为[${String(e.value).replaceAll(",","、")}]中之一`;case"B":return`${e.value[0]} < ${e.title} < ${e.value[1]}`;case"AB":return`${e.value[0]} ≤ ${e.title} < ${e.value[1]}`;case"BA":return`${e.value[0]} < ${e.title} ≤ ${e.value[1]}`;case"ABA":return`${e.value[0]} ≤ ${e.title} ≤ ${e.value[1]}`;case"<=":return`${e.title} ≤ ${this.getDefault(e.value[0]," ?")}`;case">=":return`${e.title} ≥ ${this.getDefault(e.value[0]," ?")}`;default:return`${e.title}${e.compare}${this.getDefault(e.value[0]," ?")}`}},validate(e){const t=this.config.props;if(t.groups.length<=0)this.showError=!0,this.errorInfo="请设置分支条件",e.push(this.config.name+" 未设置条件");else for(let i=0;i<t.groups.length;i++){if(0===t.groups[i].cids.length){this.showError=!0,this.errorInfo=`请设置条件组${this.groupNames[i]}内的条件`,e.push(`条件 ${this.config.name} 条件组${this.groupNames[i]}内未设置条件`);break}{let s=t.groups[i].conditions;for(let t=0;t<s.length;t++){let o=s[t];if(0===o.value.length?this.showError=!0:this.showError=!1,this.showError)return this.errorInfo=`请完善条件组${this.groupNames[i]}内的${o.title}条件`,e.push(`条件 ${this.config.name} 条件组${this.groupNames[i]}内${o.title}条件未完善`),!1}}}return!this.showError}}},Gt=Vt,qt=(i("bb26"),Object(c["a"])(Gt,Ft,Mt,!1,null,"0578561a",null)),Ht=qt.exports,Jt=function(){var e=this,t=e._self._c;return t("node",{attrs:{title:e.config.name,"show-error":e.showError,content:e.content,"error-info":e.errorInfo,placeholder:"请设置触发器","header-bgc":"#47bc82","header-icon":"el-icon-set-up"},on:{selected:function(t){return e.$emit("selected")},delNode:function(t){return e.$emit("delNode")},insertNode:t=>e.$emit("insertNode",t)}})},Yt=[],Wt={name:"TriggerNode",props:{config:{type:Object,default:()=>({})}},components:{Node:St},data(){return{showError:!1,errorInfo:""}},computed:{content(){this.config}},methods:{validate(e){return this.showError=!1,"WEBHOOK"===this.config.props.type?this.$isNotEmpty(this.config.props.http.url)?this.showError=!1:(this.showError=!0,this.errorInfo="请设置WEBHOOK的URL地址"):"EMAIL"===this.config.props.type&&(this.$isNotEmpty(this.config.props.email.subject)&&0!==this.config.props.email.to.length&&this.$isNotEmpty(this.config.props.email.content)?this.showError=!1:(this.showError=!0,this.errorInfo="请设置邮件发送配置")),this.showError&&e.push(this.config.name+" 触发动作未设置完善"),!this.showError}}},Kt=Wt,Xt=Object(c["a"])(Kt,Jt,Yt,!1,null,"3d299947",null),Zt=Xt.exports,Qt=function(){var e=this,t=e._self._c;return t("node",{attrs:{title:e.config.name,"show-error":e.showError,content:e.content,"error-info":e.errorInfo,placeholder:"请设置延时时间","header-bgc":"#f25643","header-icon":"el-icon-time"},on:{selected:function(t){return e.$emit("selected")},delNode:function(t){return e.$emit("delNode")},insertNode:t=>e.$emit("insertNode",t)}})},ei=[],ti={name:"DelayNode",props:{config:{type:Object,default:()=>({})}},components:{Node:St},data(){return{showError:!1,errorInfo:""}},computed:{content(){return"FIXED"===this.config.props.type?`等待 ${this.config.props.time} ${this.getName(this.config.props.unit)}`:"AUTO"===this.config.props.type?"至当天 "+this.config.props.dateTime:null}},methods:{validate(e){this.showError=!1;try{"AUTO"===this.config.props.type?""===(this.config.props.dateTime||"")&&(this.showError=!0,this.errorInfo="请选择时间点"):this.config.props.time<=0&&(this.showError=!0,this.errorInfo="请设置延时时长")}catch(t){this.showError=!0,this.errorInfo="配置出现问题"}return this.showError&&e.push(this.config.name+" 未设置延时规则"),!this.showError},getName(e){switch(e){case"D":return"天";case"H":return"小时";case"M":return"分钟";default:return"未知"}}}},ii=ti,si=Object(c["a"])(ii,Qt,ei,!1,null,"0ed9ede5",null),oi=si.exports,li=function(){var e=this,t=e._self._c;return t("node",{attrs:{show:!1},on:{insertNode:t=>e.$emit("insertNode",t)}})},ni=[],ri={name:"EmptyNode",components:{Node:St},data(){return{}},methods:{}},ai=ri,ci=Object(c["a"])(ai,li,ni,!1,null,"c70b12b0",null),di=ci.exports,ui=function(){var e=this,t=e._self._c;return t("node",{attrs:{title:"发起人","is-root":!0,content:e.content,placeholder:"所有人","header-bgc":"#576a95","header-icon":"el-icon-user-solid"},on:{selected:function(t){return e.$emit("selected")},insertNode:t=>e.$emit("insertNode",t)}})},pi=[],mi={name:"RootNode",components:{Node:St},props:{config:{type:Object,default:()=>({})}},computed:{content(){if(this.config.props.assignedUser.length>0){let e=[];return this.config.props.assignedUser.forEach(t=>e.push(t.name)),String(e).replaceAll(",","、")}return"所有人"}},data(){return{}},methods:{}},hi=mi,fi=Object(c["a"])(hi,ui,pi,!1,null,"5f3c2dc2",null),vi=fi.exports;const gi={assignedType:"ASSIGN_USER",mode:"AND",sign:!1,nobody:{handler:"TO_PASS",assignedUser:[]},timeLimit:{timeout:{unit:"H",value:0},handler:{type:"REFUSE",notify:{once:!0,hour:1}}},assignedUser:[],formPerms:[],formVariables:[],selfSelect:{multiple:!1},leaderTop:{endCondition:"TOP",endLevel:1},leader:{level:1},role:[],refuse:{type:"TO_END",target:""},formUser:""},bi={assignedUser:[],formPerms:[]},yi={groupsType:"OR",groups:[{groupType:"AND",cids:[],conditions:[]}],expression:""},_i={shouldAdd:!1,assignedUser:[],formPerms:[]},ki={type:"WEBHOOK",http:{method:"GET",url:"",headers:[{name:"",isField:!0,value:""}],contentType:"FORM",params:[{name:"",isField:!0,value:""}],retry:1,handlerByScript:!1,success:"function handlerOk(res) {\n  return true;\n}",fail:"function handlerFail(res) {\n  return true;\n}"},email:{subject:"",to:[],content:""}},xi={type:"FIXED",time:0,unit:"M",dateTime:""};var Si,wi,Ci={APPROVAL_PROPS:gi,CC_PROPS:_i,DELAY_PROPS:xi,CONDITION_PROPS:yi,ROOT_PROPS:bi,TRIGGER_PROPS:ki},Ni={name:"ProcessTree",components:{Node:St,Root:vi,Approval:$t,Cc:Rt,Trigger:Zt,Concurrent:jt,Condition:Ht,Delay:oi,Empty:di},data(){return{valid:!0}},computed:{nodeMap(){return this.$store.state.nodeMap},dom(){return this.$store.state.design.process}},render(e,t){console.log("渲染流程树"),this.nodeMap.clear();let i=this.getDomTree(e,this.dom);return i.push(e("div",{style:{"text-align":"center"}},[e("div",{class:{"process-end":!0},domProps:{innerHTML:"流程结束"}})])),e("div",{class:{_root:!0},ref:"_root"},i)},methods:{getDomTree(e,t){if(this.toMapping(t),this.isPrimaryNode(t)){let i=this.getDomTree(e,t.children);return this.decodeAppendDom(e,t,i),[e("div",{class:{"primary-node":!0}},i)]}if(this.isBranchNode(t)){let i=0,s=t.branchs.map(s=>{this.toMapping(s);let o=this.getDomTree(e,s.children);return this.decodeAppendDom(e,s,o,{level:i+1,size:t.branchs.length}),this.insertCoverLine(e,i,o,t.branchs),i++,e("div",{class:{"branch-node-item":!0}},o)});s.unshift(e("div",{class:{"add-branch-btn":!0}},[e("el-button",{class:{"add-branch-btn-el":!0},props:{size:"small",round:!0},on:{click:()=>this.addBranchNode(t)},domProps:{innerHTML:"添加"+(this.isConditionNode(t)?"条件":"分支")}},[])]));let o=[e("div",{class:{"branch-node":!0}},s)],l=this.getDomTree(e,t.children);return[e("div",{},[o,l])]}if(this.isEmptyNode(t)){let i=this.getDomTree(e,t.children);return this.decodeAppendDom(e,t,i),[e("div",{class:{"empty-node":!0}},i)]}return[]},decodeAppendDom(e,t,i,s={}){s.config=t,i.unshift(e(t.type.toLowerCase(),{props:s,ref:t.id,key:t.id,on:{insertNode:e=>this.insertNode(e,t),delNode:()=>this.delNode(t),selected:()=>this.selectNode(t),copy:()=>this.copyBranch(t),leftMove:()=>this.branchMove(t,-1),rightMove:()=>this.branchMove(t,1)}},[]))},toMapping(e){e&&e.id&&this.nodeMap.set(e.id,e)},insertCoverLine(e,t,i,s){0===t?(i.unshift(e("div",{class:{"line-top-left":!0}},[])),i.unshift(e("div",{class:{"line-bot-left":!0}},[]))):t===s.length-1&&(i.unshift(e("div",{class:{"line-top-right":!0}},[])),i.unshift(e("div",{class:{"line-bot-right":!0}},[])))},copyBranch(e){let t=this.nodeMap.get(e.parentId),i=this.$deepCopy(e);i.name=i.name+"-copy",this.forEachNode(t,i,(e,t)=>{let i=this.getRandomId();console.log(t,"新id =>"+i,"老nodeId:"+t.id),t.id=i,t.parentId=e.id}),t.branchs.splice(t.branchs.indexOf(e),0,i),this.$forceUpdate()},branchMove(e,t){let i=this.nodeMap.get(e.parentId),s=i.branchs.indexOf(e),o=i.branchs[s+t];i.branchs[s+t]=i.branchs[s],i.branchs[s]=o,this.$forceUpdate()},isPrimaryNode(e){return e&&("ROOT"===e.type||"APPROVAL"===e.type||"CC"===e.type||"DELAY"===e.type||"TRIGGER"===e.type)},isBranchNode(e){return e&&("CONDITIONS"===e.type||"CONCURRENTS"===e.type)},isEmptyNode(e){return e&&"EMPTY"===e.type},isConditionNode(e){return"CONDITIONS"===e.type},isBranchSubNode(e){return e&&("CONDITION"===e.type||"CONCURRENT"===e.type)},isConcurrentNode(e){return"CONCURRENTS"===e.type},getRandomId(){return`node_${(new Date).getTime().toString().substring(5)}${Math.round(9e3*Math.random()+1e3)}`},selectNode(e){console.log("select node: ",e),e.props.formVariables=e.props.formVariables||[],this.$store.commit("selectedNode",e),this.$emit("selectedNode",e)},insertNode(e,t){this.$refs["_root"].click();let i=t.children;switch(t.children={id:this.getRandomId(),parentId:t.id,props:{},type:e},e){case"APPROVAL":this.insertApprovalNode(t,i);break;case"CC":this.insertCcNode(t);break;case"DELAY":this.insertDelayNode(t);break;case"TRIGGER":this.insertTriggerNode(t);break;case"CONDITIONS":this.insertConditionsNode(t);break;case"CONCURRENTS":this.insertConcurrentsNode(t);break;default:break}this.isBranchNode({type:e})?(i&&i.id&&(i.parentId=t.children.children.id),this.$set(t.children.children,"children",i)):(i&&i.id&&(i.parentId=t.children.id),this.$set(t.children,"children",i)),this.$forceUpdate()},insertApprovalNode(e){this.$set(e.children,"name","审批人"),this.$set(e.children,"props",this.$deepCopy(Ci.APPROVAL_PROPS))},insertCcNode(e){this.$set(e.children,"name","抄送人"),this.$set(e.children,"props",this.$deepCopy(Ci.CC_PROPS))},insertDelayNode(e){this.$set(e.children,"name","延时处理"),this.$set(e.children,"props",this.$deepCopy(Ci.DELAY_PROPS))},insertTriggerNode(e){this.$set(e.children,"name","触发器"),this.$set(e.children,"props",this.$deepCopy(Ci.TRIGGER_PROPS))},insertConditionsNode(e){this.$set(e.children,"name","条件分支"),this.$set(e.children,"children",{id:this.getRandomId(),parentId:e.children.id,type:"EMPTY"}),this.$set(e.children,"branchs",[{id:this.getRandomId(),parentId:e.children.id,type:"CONDITION",props:this.$deepCopy(Ci.CONDITION_PROPS),name:"条件1",children:{}},{id:this.getRandomId(),parentId:e.children.id,type:"CONDITION",props:this.$deepCopy(Ci.CONDITION_PROPS),name:"条件2",children:{}}])},insertConcurrentsNode(e){this.$set(e.children,"name","并行分支"),this.$set(e.children,"children",{id:this.getRandomId(),parentId:e.children.id,type:"EMPTY"}),this.$set(e.children,"branchs",[{id:this.getRandomId(),name:"分支1",parentId:e.children.id,type:"CONCURRENT",props:{},children:{}},{id:this.getRandomId(),name:"分支2",parentId:e.children.id,type:"CONCURRENT",props:{},children:{}}])},getBranchEndNode(e){return e.children&&e.children.id?this.getBranchEndNode(e.children):e},addBranchNode(e){e.branchs.length<8?e.branchs.push({id:this.getRandomId(),parentId:e.id,name:(this.isConditionNode(e)?"条件":"分支")+(e.branchs.length+1),props:this.isConditionNode(e)?this.$deepCopy(Ci.CONDITION_PROPS):{},type:this.isConditionNode(e)?"CONDITION":"CONCURRENT",children:{}}):this.$message.warning("最多只能添加 8 项😥")},delNode(e){console.log("删除节点",e);let t=this.nodeMap.get(e.parentId);if(t){if(this.isBranchNode(t)){if(t.branchs.splice(t.branchs.indexOf(e),1),t.branchs.length<2){let e=this.nodeMap.get(t.parentId);if(t.branchs[0].children&&t.branchs[0].children.id){e.children=t.branchs[0].children,e.children.parentId=e.id;let i=this.getBranchEndNode(t.branchs[0]);i.children=t.children.children,i.children&&i.children.id&&(i.children.parentId=i.id)}else e.children=t.children.children,e.children&&e.children.id&&(e.children.parentId=e.id)}}else e.children&&e.children.id&&(e.children.parentId=t.id),t.children=e.children;this.$forceUpdate()}else this.$message.warning("出现错误，找不到上级节点😥")},validateProcess(){this.valid=!0;let e=[];return this.validate(e,this.dom),e},validateNode(e,t){this.$refs[t.id].validate&&(this.valid=this.$refs[t.id].validate(e))},nodeDomUpdate(e){this.$refs[e.id].$forceUpdate()},forEachNode(e,t,i){this.isBranchNode(t)?(i(e,t),this.forEachNode(t,t.children,i),t.branchs.map(e=>{i(t,e),this.forEachNode(e,e.children,i)})):(this.isPrimaryNode(t)||this.isEmptyNode(t)||this.isBranchSubNode(t))&&(i(e,t),this.forEachNode(t,t.children,i))},validate(e,t){this.isPrimaryNode(t)?(this.validateNode(e,t),this.validate(e,t.children)):this.isBranchNode(t)?(t.branchs.map(t=>{this.validateNode(e,t),this.validate(e,t.children)}),this.validate(e,t.children)):this.isEmptyNode(t)&&this.validate(e,t.children)}},watch:{}},$i=Ni,Oi=(i("d63a"),Object(c["a"])($i,Si,wi,!1,null,"776a622e",null)),Ii=Oi.exports,Ei=function(){var e=this,t=e._self._c;return t("div",[e.name?t("el-tabs",{model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},[t("el-tab-pane",{attrs:{label:e.name,name:"properties"}},[t((e.selectNode.type||"").toLowerCase(),{tag:"component",attrs:{config:e.selectNode.props}})],1),t("el-tab-pane",{attrs:{label:"表单权限设置",name:"permissions"}},[t("form-authority-config")],1),t("el-tab-pane",{attrs:{label:"表单变量设置",name:"variables"}},[t("form-variables-config")],1)],1):t((e.selectNode.type||"").toLowerCase(),{tag:"component",attrs:{config:e.selectNode.props}})],1)},Ti=[],Pi=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{attrs:{"label-position":"top","label-width":"90px"}},[t("el-form-item",{staticClass:"user-type",attrs:{label:"⚙ 选择审批对象",prop:"text"}},[t("el-radio-group",{model:{value:e.nodeProps.assignedType,callback:function(t){e.$set(e.nodeProps,"assignedType",t)},expression:"nodeProps.assignedType"}},e._l(e.approvalTypes,(function(i){return t("el-radio",{key:i.type,attrs:{label:i.type}},[e._v(e._s(i.name))])})),1),"ASSIGN_USER"===e.nodeProps.assignedType?t("div",[t("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary",round:""},on:{click:e.selectUser}},[e._v("选择人员")]),t("org-items",{model:{value:e.nodeProps.assignedUser,callback:function(t){e.$set(e.nodeProps,"assignedUser",t)},expression:"nodeProps.assignedUser"}})],1):"SELF_SELECT"===e.nodeProps.assignedType?t("div",[t("el-radio-group",{attrs:{size:"mini"},model:{value:e.nodeProps.selfSelect.multiple,callback:function(t){e.$set(e.nodeProps.selfSelect,"multiple",t)},expression:"nodeProps.selfSelect.multiple"}},[t("el-radio-button",{attrs:{label:!1}},[e._v("自选一个人")]),t("el-radio-button",{attrs:{label:!0}},[e._v("自选多个人")])],1)],1):"LEADER_TOP"===e.nodeProps.assignedType?t("div",[t("el-divider"),t("el-form-item",{staticClass:"approve-end",attrs:{label:"审批终点",prop:"text"}},[t("el-radio-group",{model:{value:e.nodeProps.leaderTop.endCondition,callback:function(t){e.$set(e.nodeProps.leaderTop,"endCondition",t)},expression:"nodeProps.leaderTop.endCondition"}},[t("el-radio",{attrs:{label:"TOP"}},[e._v("直到最上层主管")]),t("el-radio",{attrs:{label:"LEAVE"}},[e._v("不超过发起人的")])],1),"LEAVE"===e.nodeProps.leaderTop.endCondition?t("div",{staticClass:"approve-end-leave"},[t("span",[e._v("第 ")]),t("el-input-number",{attrs:{min:1,max:20,step:1,size:"mini"},model:{value:e.nodeProps.leaderTop.level,callback:function(t){e.$set(e.nodeProps.leaderTop,"level",t)},expression:"nodeProps.leaderTop.level"}}),t("span",[e._v(" 级主管")])],1):e._e()],1)],1):"LEADER"===e.nodeProps.assignedType?t("div",[t("el-divider"),t("el-form-item",{attrs:{label:"指定主管",prop:"text"}},[t("span",[e._v("发起人的第 ")]),t("el-input-number",{attrs:{min:1,max:20,step:1,size:"mini"},model:{value:e.nodeProps.leader.level,callback:function(t){e.$set(e.nodeProps.leader,"level",t)},expression:"nodeProps.leader.level"}}),t("span",[e._v(" 级主管")]),t("div",{staticStyle:{color:"#409EFF","font-size":"small"}},[e._v("👉 直接主管为 第 1 级主管")])],1)],1):"ROLE"===e.nodeProps.assignedType?t("div",[t("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary",round:""},on:{click:e.selectRole}},[e._v("选择系统角色")]),t("org-items",{attrs:{type:"role"},model:{value:e.nodeProps.role,callback:function(t){e.$set(e.nodeProps,"role",t)},expression:"nodeProps.role"}})],1):"FORM_USER"===e.nodeProps.assignedType?t("div",[t("el-form-item",{staticClass:"approve-end",attrs:{label:"选择表单联系人项",prop:"text"}},[t("el-select",{staticStyle:{width:"80%"},attrs:{size:"small",placeholder:"请选择包含联系人的表单项"},model:{value:e.nodeProps.formUser,callback:function(t){e.$set(e.nodeProps,"formUser",t)},expression:"nodeProps.formUser"}},e._l(e.forms,(function(e){return t("el-option",{attrs:{label:e.title,value:e.id}})})),1)],1)],1):t("div",[t("span",{staticClass:"item-desc"},[e._v("发起人自己作为审批人进行审批")])])],1),t("el-divider"),t("el-form-item",{staticClass:"line-mode",attrs:{label:"👤 审批人为空时",prop:"text"}},[t("el-radio-group",{model:{value:e.nodeProps.nobody.handler,callback:function(t){e.$set(e.nodeProps.nobody,"handler",t)},expression:"nodeProps.nobody.handler"}},[t("el-radio",{attrs:{label:"TO_PASS"}},[e._v("自动通过")]),t("el-radio",{attrs:{label:"TO_REFUSE"}},[e._v("自动驳回")]),t("el-radio",{attrs:{label:"TO_ADMIN"}},[e._v("转交审批管理员")]),t("el-radio",{attrs:{label:"TO_USER"}},[e._v("转交到指定人员")])],1),"TO_USER"===e.nodeProps.nobody.handler?t("div",{staticStyle:{"margin-top":"10px"}},[t("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary",round:""},on:{click:e.selectNoSetUser}},[e._v("选择人员")]),t("org-items",{model:{value:e.nodeProps.assignedUser,callback:function(t){e.$set(e.nodeProps,"assignedUser",t)},expression:"nodeProps.assignedUser"}})],1):e._e()],1),e.showMultiApprove?t("div",[t("el-divider"),t("el-form-item",{staticClass:"approve-mode",attrs:{label:"👩‍👦‍👦 多人审批时审批方式",prop:"text"}},[t("el-radio-group",{model:{value:e.nodeProps.mode,callback:function(t){e.$set(e.nodeProps,"mode",t)},expression:"nodeProps.mode"}},[t("el-radio",{attrs:{label:"WAIT_CLAIM"}},[e._v("等待用户认领")]),t("el-radio",{attrs:{label:"SELECT_ONE"}},[e._v("提交时用户选择（选择一人）")]),t("el-radio",{attrs:{label:"SELECT_MULTIPLE"}},[e._v("提交时用户选择（选择多人）")])],1)],1)],1):e._e(),t("el-divider",[e._v("高级设置")]),t("el-form-item",{attrs:{label:"⏱ 审批期限（为 0 则不生效）",prop:"timeLimit"}},[t("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"时长",size:"small",type:"number"},model:{value:e.nodeProps.timeLimit.timeout.value,callback:function(t){e.$set(e.nodeProps.timeLimit.timeout,"value",t)},expression:"nodeProps.timeLimit.timeout.value"}},[t("el-select",{staticStyle:{width:"75px"},attrs:{slot:"append",placeholder:"请选择"},slot:"append",model:{value:e.nodeProps.timeLimit.timeout.unit,callback:function(t){e.$set(e.nodeProps.timeLimit.timeout,"unit",t)},expression:"nodeProps.timeLimit.timeout.unit"}},[t("el-option",{attrs:{label:"天",value:"D"}}),t("el-option",{attrs:{label:"小时",value:"H"}})],1)],1)],1),e.nodeProps.timeLimit.timeout.value>0?t("el-form-item",{attrs:{label:"审批期限超时后执行",prop:"level"}},[t("el-radio-group",{model:{value:e.nodeProps.timeLimit.handler.type,callback:function(t){e.$set(e.nodeProps.timeLimit.handler,"type",t)},expression:"nodeProps.timeLimit.handler.type"}},[t("el-radio",{attrs:{label:"PASS"}},[e._v("自动通过")]),t("el-radio",{attrs:{label:"REFUSE"}},[e._v("自动驳回")]),t("el-radio",{attrs:{label:"NOTIFY"}},[e._v("发送提醒")])],1),"NOTIFY"===e.nodeProps.timeLimit.handler.type?t("div",[t("div",{staticStyle:{color:"#409EEF","font-size":"small"}},[e._v("默认提醒当前审批人")]),t("el-switch",{attrs:{"inactive-text":"循环","active-text":"一次"},model:{value:e.nodeProps.timeLimit.handler.notify.once,callback:function(t){e.$set(e.nodeProps.timeLimit.handler.notify,"once",t)},expression:"nodeProps.timeLimit.handler.notify.once"}}),e.nodeProps.timeLimit.handler.notify.once?e._e():t("span",{staticStyle:{"margin-left":"20px"}},[e._v(" 每隔 "),t("el-input-number",{attrs:{min:0,max:1e4,step:1,size:"mini"},model:{value:e.nodeProps.timeLimit.handler.notify.hour,callback:function(t){e.$set(e.nodeProps.timeLimit.handler.notify,"hour",t)},expression:"nodeProps.timeLimit.handler.notify.hour"}}),e._v(" 小时提醒一次 ")],1)],1):e._e()],1):e._e(),t("el-form-item",{attrs:{label:"🙅‍ 如果审批被驳回 👇"}},[t("el-radio-group",{model:{value:e.nodeProps.refuse.type,callback:function(t){e.$set(e.nodeProps.refuse,"type",t)},expression:"nodeProps.refuse.type"}},[t("el-radio",{attrs:{label:"TO_END"}},[e._v("直接结束流程")]),t("el-radio",{attrs:{label:"TO_BEFORE"}},[e._v("驳回到上级审批节点")]),t("el-radio",{attrs:{label:"TO_NODE"}},[e._v("驳回到指定节点")])],1),"TO_NODE"===e.nodeProps.refuse.type?t("div",[t("span",[e._v("指定节点:")]),t("el-select",{staticStyle:{"margin-left":"10px",width:"150px"},attrs:{placeholder:"选择跳转步骤",size:"small"},model:{value:e.nodeProps.refuse.target,callback:function(t){e.$set(e.nodeProps.refuse,"target",t)},expression:"nodeProps.refuse.target"}},e._l(e.nodeOptions,(function(e,i){return t("el-option",{key:i,attrs:{label:e.name,value:e.id}})})),1)],1):e._e()],1)],1),"ASSIGN_USER"===e.nodeProps.assignedType?t("org-picker",{ref:"orgPicker",attrs:{title:e.pickerTitle,multiple:"",type:e.orgPickerType,selected:e.orgPickerSelected},on:{ok:e.selected}}):"ROLE"===e.nodeProps.assignedType?t("role-picker",{ref:"rolePicker",attrs:{multiple:"",selected:e.orgPickerSelected},on:{ok:e.selected}}):e._e()],1)},Ri=[],Li=function(){var e=this,t=e._self._c;return t("w-dialog",{attrs:{border:!1,closeFree:"",width:"520px",title:"请选择系统角色"},on:{ok:e.selectOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[t("div",{staticClass:"picker"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"candidate"},[t("div",{staticClass:"role-header"},[t("div",[e._v("系统角色")])]),t("div",{staticClass:"org-items",style:"role"===e.type?"height: 350px":""},[t("el-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.roles.length,expression:"roles.length === 0"}],attrs:{"image-size":100,description:"似乎没有数据"}}),e._l(e.roles,(function(i,s){return t("div",{key:s,class:e.orgItemClass(i),on:{click:function(t){return e.selectChange(i)}}},[t("el-checkbox",{attrs:{disabled:e.disableDept(i)},model:{value:i.selected,callback:function(t){e.$set(i,"selected",t)},expression:"org.selected"}}),t("div",{staticStyle:{display:"flex","align-items":"center",flex:"1"}},[t("i",{staticClass:"el-icon-folder-opened"}),t("span",{staticClass:"name"},[e._v(e._s(i.name))])])],1)}))],2)]),t("div",{staticClass:"selected"},[t("div",{staticClass:"count"},[t("span",[e._v("已选 "+e._s(e.select.length)+" 项")]),t("span",{on:{click:e.clearSelected}},[e._v("清空")])]),t("div",{staticClass:"org-items",staticStyle:{height:"350px"}},[t("el-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.select.length,expression:"select.length === 0"}],attrs:{"image-size":100,description:"请点击左侧列表选择数据"}}),e._l(e.select,(function(i,s){return t("div",{key:s,class:e.orgItemClass(i)},["dept"===i.type?t("div",[t("i",{staticClass:"el-icon-folder-opened"}),t("span",{staticClass:"name",staticStyle:{position:"static"}},[e._v(e._s(i.name))])]):"user"===i.type?t("div",{staticStyle:{display:"flex","align-items":"center"}},[e.$isNotEmpty(i.avatar)?t("el-avatar",{attrs:{size:35,src:i.avatar}}):t("span",{staticClass:"avatar"},[e._v(e._s(e.getShortName(i.name)))]),t("span",{staticClass:"name"},[e._v(e._s(i.name))])],1):t("div",[t("i",{staticClass:"iconfont icon-bumen"}),t("span",{staticClass:"name"},[e._v(e._s(i.name))])]),t("i",{staticClass:"el-icon-close",on:{click:function(t){return e.noSelected(s)}}})])}))],2)])])])},zi=[],Di=i("24fd"),Ai={name:"RolePicker",components:{},props:{type:{default:"role",type:String},multiple:{default:!1,type:Boolean},selected:{default:()=>[],type:Array}},data(){return{visible:!1,loading:!1,checkAll:!1,nowDeptId:null,isIndeterminate:!1,searchUserList:[],nodes:[],select:[],search:""}},computed:{roles(){return this.nodes}},methods:{show(){this.visible=!0,this.init(),this.getRoleList()},orgItemClass(e){return{"org-item":!0,"org-dept-item":"dept"===e.type,"org-user-item":"user"===e.type,"org-role-item":"role"===e.type}},disableDept(e){return"user"===this.type&&"dept"===e.type},getRoleList(){this.loading=!0,Object(Di["b"])({}).then(e=>{this.loading=!1,this.nodes=e.data.map(e=>(e.roleId=e.id,e.id=e.code,e))}).then(()=>{this.selectToLeft()}).catch(e=>{this.loading=!1,this.$message.error(e.response.data)})},getShortName(e){return e?e.length>2?e.substring(1,3):e:"**"},selectToLeft(){this.select=Object.assign([],this.selected),this.nodes.forEach(e=>{for(let t=0;t<this.select.length;t++){if(this.select[t].id===e.id){e.selected=!0;break}e.selected=!1}})},selectChange(e){if(e.selected){this.checkAll=!1;for(let t=0;t<this.select.length;t++)if(this.select[t].id===e.id){this.select.splice(t,1);break}e.selected=!1}else if(!this.disableDept(e)){e.selected=!0;let t=""===this.search.trim()?this.nodes:this.searchUserList;this.multiple||t.forEach(t=>{e.id!==t.id&&(t.selected=!1)}),"dept"===e.type?this.multiple?this.select.unshift(e):this.select=[e]:this.multiple?this.select.push(e):this.select=[e]}},noSelected(e){let t=this.nodes;for(let i=0;i<2;i++){for(let i=0;i<t.length;i++)if(t[i].id===this.select[e].id){t[i].selected=!1,this.checkAll=!1;break}t=this.searchUserList}this.select.splice(e,1)},recover(){this.select=[],this.nodes.forEach(e=>e.selected=!1)},selectOk(){this.$emit("ok",Object.assign([],this.select.map(e=>({id:e.id,name:e.name,type:"role"})))),this.visible=!1,this.recover()},clearSelected(){this.$confirm("您确定要清空已选中的项?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{this.recover()})},close(){this.$emit("close"),this.recover()},init(){this.checkAll=!1,this.nowDeptId=null,this.deptStack=[],this.nodes=[],this.selectToLeft()}}},Ui=Ai,ji=(i("9c9c"),Object(c["a"])(Ui,Li,zi,!1,null,"18ba48f0",null)),Fi=ji.exports,Mi=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{"margin-top":"10px"}},e._l(e._value,(function(i,s){return t("el-tag",{key:s+"_org",staticClass:"org-item",attrs:{type:"dept"===i.type?"":"info",closable:"",size:"mini"},on:{close:function(t){return e.removeOrgItem(s)}}},[e._v(" "+e._s(i.name)+" ")])})),1)},Bi=[],Vi={name:"OrgItems",components:{},props:{value:{type:Array,default:()=>[]}},computed:{_value:{get(){return this.value},set(e){this.$emit("input",e)}}},data(){return{}},methods:{removeOrgItem(e){this._value.splice(e,1)}}},Gi=Vi,qi=(i("63ad"),Object(c["a"])(Gi,Mi,Bi,!1,null,"7e2e8510",null)),Hi=qi.exports,Ji={name:"ApprovalNodeConfig",components:{OrgPicker:f["a"],OrgItems:Hi,RolePicker:Fi},props:{config:{type:Object,default:()=>({})}},data(){return{showOrgSelect:!1,orgPickerSelected:[],orgPickerType:"user",approvalTypes:[{name:"指定人员",type:"ASSIGN_USER"},{name:"发起人自选",type:"SELF_SELECT"},{name:"角色",type:"ROLE"},{name:"发起人自己",type:"SELF"},{name:"表单内联系人",type:"FORM_USER"}]}},computed:{nodeProps(){return this.$store.state.selectedNode.props},select(){return this.config.assignedUser||[]},selectRoles(){return this.config.role||[]},forms(){return console.log(this.$store.state.design.formItems),this.$store.state.design.formItems.filter(e=>!0)},pickerTitle(){switch(this.orgPickerType){case"user":return"请选择人员";case"role":return"请选择系统角色";default:return null}},nodeOptions(){let e=[];const t=["ROOT","EMPTY","CONDITION","CONDITIONS","CONCURRENT","CONCURRENTS"];return this.$store.state.nodeMap.forEach(i=>{-1===t.indexOf(i.type)&&e.push({id:i.id,name:i.name})}),e},showMultiApprove(){switch(this.nodeProps.assignedType){case"ASSIGN_USER":return this.nodeProps.assignedUser.length>0;case"SELF_SELECT":return this.nodeProps.selfSelect.multiple;case"LEADER_TOP":return""!==this.nodeProps.formUser;case"FORM_USER":return!0;case"ROLE":return!0;default:return!1}}},methods:{selectUser(){this.orgPickerSelected=this.select,this.orgPickerType="user",this.$refs.orgPicker.show()},selectNoSetUser(){this.orgPickerSelected=this.config.nobody.assignedUser,this.orgPickerType="user",this.$refs.orgPicker.show()},selectRole(){this.orgPickerSelected=this.selectRoles,this.orgPickerType="role",this.$refs.rolePicker.show()},selected(e){console.log("select--------",e),this.orgPickerSelected.length=0,e.forEach(e=>this.orgPickerSelected.push(e))},removeOrgItem(e){this.select.splice(e,1)}}},Yi=Ji,Wi=(i("655f"),Object(c["a"])(Yi,Pi,Ri,!1,null,"5d81ee7f",null)),Ki=Wi.exports,Xi=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{attrs:{inline:"","label-width":"100px"}},[t("el-form-item",{attrs:{label:"调整优先级",prop:"level"}},[t("el-popover",{attrs:{placement:"right",title:"拖拽条件调整优先级顺序",width:"250",trigger:"click"}},[t("draggable",{staticStyle:{width:"100%","min-height":"25px"},attrs:{list:e.prioritySortList,group:"from",options:e.sortOption}},e._l(e.prioritySortList,(function(i,s){return t("div",{class:{"drag-no-choose":!0,"drag-hover":i.id===e.selectedNode.id}},[t("ellipsis",{staticStyle:{width:"160px"},attrs:{"hover-tip":"",content:i.name}}),t("div",[e._v("优先级 "+e._s(s+1))])],1)})),0),t("el-button",{attrs:{slot:"reference",icon:"el-icon-sort",size:"small"},slot:"reference"},[e._v("第"+e._s(e.nowNodeLeave+1)+"级")])],1)],1),t("el-form-item",{attrs:{label:"条件组关系","label-width":"150px"}},[t("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#c1c1c1","active-value":"AND","inactive-value":"OR","active-text":"且","inactive-text":"或"},model:{value:e.config.groupsType,callback:function(t){e.$set(e.config,"groupsType",t)},expression:"config.groupsType"}})],1),t("el-form-item",{attrs:{label:"条件组表达式"}},[t("el-input",{attrs:{size:"mini",placeholder:"输入条件组关系表达式  &为与，|为或"},model:{value:e.config.expression,callback:function(t){e.$set(e.config,"expression",t)},expression:"config.expression"}}),t("span",{staticClass:"item-desc"},[e._v("使用表达式构建复杂逻辑，例如: (A & B) | C")])],1)],1),t("div",[t("el-button",{staticStyle:{margin:"0 15px 15px 0"},attrs:{type:"primary",size:"mini",icon:"el-icon-plus",round:""},on:{click:e.addConditionGroup}},[e._v(" 添加条件组 ")]),t("span",{staticClass:"item-desc"},[e._v("只有必填选项才能作为审批条件")])],1),t("group-item")],1)},Zi=[],Qi=function(){var e=this,t=e._self._c;return t("div",[e._l(e.selectedNode.props.groups,(function(i,s){return t("div",{key:s+"_g",staticClass:"group"},[t("div",{staticClass:"group-header"},[t("span",{staticClass:"group-name"},[e._v("条件组 "+e._s(e.groupNames[s]))]),t("div",{staticClass:"group-cp"},[t("span",[e._v("组内条件关系：")]),t("el-switch",{attrs:{"active-color":"#409EFF","inactive-color":"#c1c1c1","active-value":"AND","inactive-value":"OR","active-text":"且","inactive-text":"或"},model:{value:i.groupType,callback:function(t){e.$set(i,"groupType",t)},expression:"group.groupType"}})],1),t("div",{staticClass:"group-operation"},[t("el-popover",{attrs:{placement:"bottom",title:"选择审批条件",width:"300",trigger:"click"}},[t("el-checkbox-group",{attrs:{"value-key":"id"},model:{value:i.cids,callback:function(t){e.$set(i,"cids",t)},expression:"group.cids"}},e._l(e.conditionList,(function(s,o){return t("el-checkbox",{key:s.id,attrs:{label:s.id},on:{change:function(t){return e.conditionChange(o,i)}}},[e._v(" "+e._s(s.title)+" ")])})),1),t("i",{staticClass:"el-icon-plus",attrs:{slot:"reference"},slot:"reference"})],1),t("i",{staticClass:"el-icon-delete",on:{click:function(t){return e.delGroup(s)}}})],1)]),t("div",{staticClass:"group-content"},[0===i.conditions.length?t("p",[e._v("点击右上角 + 为本条件组添加条件 ☝")]):t("div",[t("el-form",{ref:"condition-form",refInFor:!0,attrs:{"label-width":"100px"}},e._l(i.conditions,(function(s,o){return t("el-form-item",{key:s.id+"_"+o},[t("ellipsis",{attrs:{slot:"label","hover-tip":"",content:s.title},slot:"label"}),s.valueType===e.ValueType.string?t("span",[t("el-select",{staticStyle:{width:"120px"},attrs:{size:"small",placeholder:"判断符"},on:{change:function(e){s.value=[]}},model:{value:s.compare,callback:function(t){e.$set(s,"compare",t)},expression:"condition.compare"}},[t("el-option",{attrs:{label:"等于",value:"="}}),t("el-option",{attrs:{label:"包含在",value:"IN"}})],1),e.isSelect(s.id)?t("span",{staticStyle:{"margin-left":"10px"}},["IN"===s.compare?t("el-select",{staticStyle:{width:"280px"},attrs:{clearable:"",multiple:"",size:"small",placeholder:"选择值"},model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"condition.value"}},e._l(e.getOptions(s.id),(function(e,i){return t("el-option",{key:i,attrs:{label:e,value:e}})})),1):t("el-select",{staticStyle:{width:"280px"},attrs:{clearable:"",size:"small",placeholder:"选择值"},model:{value:s.value[0],callback:function(t){e.$set(s.value,0,t)},expression:"condition.value[0]"}},e._l(e.getOptions(s.id),(function(e,i){return t("el-option",{key:i,attrs:{label:e,value:e}})})),1)],1):t("span",{staticStyle:{"margin-left":"10px"}},["="===s.compare?t("el-input",{staticStyle:{width:"280px"},attrs:{placeholder:"输入比较值",size:"small"},model:{value:s.value[0],callback:function(t){e.$set(s.value,0,t)},expression:"condition.value[0]"}}):t("el-select",{staticStyle:{width:"280px"},attrs:{multiple:"",clearable:"",filterable:"","allow-create":"",size:"small",placeholder:"输入可能包含的值"},model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"condition.value"}})],1)],1):s.valueType===e.ValueType.number?t("span",[t("el-select",{staticStyle:{width:"120px"},attrs:{size:"small",placeholder:"判断符"},model:{value:s.compare,callback:function(t){e.$set(s,"compare",t)},expression:"condition.compare"}},e._l(e.explains,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1),t("span",{staticStyle:{"margin-left":"10px"}},[0===e.conditionValType(s.compare)?t("el-input",{staticStyle:{width:"280px"},attrs:{size:"small",placeholder:"输入比较值",type:"number"},model:{value:s.value[0],callback:function(t){e.$set(s.value,0,t)},expression:"condition.value[0]"}}):1===e.conditionValType(s.compare)?t("el-select",{staticStyle:{width:"280px"},attrs:{multiple:"",filterable:"","allow-create":"",size:"small",placeholder:"输入可能包含的值"},model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"condition.value"}}):t("span",[t("el-input",{staticStyle:{width:"130px"},attrs:{size:"small",type:"number",placeholder:"输入比较值"},model:{value:s.value[0],callback:function(t){e.$set(s.value,0,t)},expression:"condition.value[0]"}}),t("span",[e._v(" ~ "),t("el-input",{staticStyle:{width:"130px"},attrs:{size:"small",type:"number",placeholder:"输入比较值"},model:{value:s.value[1],callback:function(t){e.$set(s.value,1,t)},expression:"condition.value[1]"}})],1)],1)],1)],1):s.valueType===e.ValueType.user?t("span",[t("span",{staticClass:"item-desc",staticStyle:{"margin-right":"20px"}},[e._v("属于某部门 / 为某些人其中之一")]),t("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary",round:""},on:{click:function(t){return e.selectUser(s.value,"user")}}},[e._v("选择人员/部门")]),t("org-items",{model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"condition.value"}})],1):s.valueType===e.ValueType.dept?t("span",[t("span",{staticClass:"item-desc",staticStyle:{"margin-right":"20px"}},[e._v("为某部门 / 某部门下的部门")]),t("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary",round:""},on:{click:function(t){return e.selectUser(s.value,"dept")}}},[e._v("选择部门")]),t("org-items",{model:{value:s.value,callback:function(t){e.$set(s,"value",t)},expression:"condition.value"}})],1):s.valueType===e.ValueType.date?t("span"):e._e(),t("i",{staticClass:"el-icon-delete",on:{click:function(t){return e.rmSubCondition(i,o)}}})],1)})),1)],1)])])})),t("org-picker",{ref:"orgPicker",attrs:{type:e.orgType,multiple:"",selected:e.users},on:{ok:e.selected}})],2)},es=[],ts={name:"ConditionGroupItemConfig",components:{OrgPicker:f["a"],OrgItems:Hi},data(){return{ValueType:st["a"],users:[],orgType:"user",showOrgSelect:!1,groupNames:["A","B","C","D","E","F","G","H","I","J"],supportTypes:[st["a"].number,st["a"].string,st["a"].date,st["a"].dept,st["a"].user],explains:[{label:"等于",value:"="},{label:"大于",value:">"},{label:"大于等于",value:">="},{label:"小于",value:"<"},{label:"小于等于",value:"<="},{label:"包含在",value:"IN"},{label:"x < 值 < x",value:"B"},{label:"x ≤ 值 < x",value:"AB"},{label:"x < 值 ≤ x",value:"BA"},{label:"x ≤ 值 ≤ x",value:"ABA"}]}},computed:{selectedNode(){return this.$store.state.selectedNode},select(){return this.selectedNode.props.assignedUser||[]},formItems(){return this.$store.state.design.formItems},formMap(){const e=new Map;return this.formItems.forEach(t=>this.itemToMap(e,t)),e},conditionList(){const e=[];return this.formItems.forEach(t=>this.filterCondition(t,e)),0!==e.length&&"root"===e[0].id||e.unshift({id:"root",title:"发起人",valueType:"User"}),e}},methods:{itemToMap(e,t){e.set(t.id,t),"SpanLayout"===t.name&&t.props.items.forEach(t=>this.itemToMap(e,t))},isSelect(e){let t=this.formMap.get(e);return!(!t||"SelectInput"!==t.name&&"MultipleSelect"!==t.name)},getOptions(e){return this.formMap.get(e).props.options||[]},conditionValType(e){switch(e){case"=":case">":case">=":case"<":case"<=":return 0;case"IN":return 1;default:return 2}},selectUser(e,t){this.orgType=t,this.users=e,this.$nextTick(()=>{this.$refs.orgPicker.show()})},filterCondition(e,t){"SpanLayout"===e.name?e.props.items.forEach(e=>this.filterCondition(e,t)):this.supportTypes.indexOf(e.valueType)>-1&&e.props.required&&t.push({title:e.title,id:e.id,valueType:e.valueType})},selected(e){console.log(e),this.users.length=0,e.forEach(e=>this.users.push(e))},delGroup(e){this.selectedNode.props.groups.splice(e,1)},rmSubCondition(e,t){e.cids.splice(t,1),e.conditions.splice(t,1)},conditionChange(e,t){t.cids.forEach(i=>{if(0>t.conditions.findIndex(e=>e.id===i)){let i={...this.conditionList[e]};console.log(i,this.conditionList,e),i.compare="",i.value=[],t.conditions.push(i)}});for(let i=0;i<t.conditions.length;i++)t.cids.indexOf(t.conditions[i].id)<0&&t.conditions.splice(i,1)}}},is=ts,ss=(i("982c"),Object(c["a"])(is,Qi,es,!1,null,"4795bc9c",null)),os=ss.exports,ls={name:"ConditionNodeConfig",components:{draggable:w.a,GroupItem:os},props:{config:{type:Object,default:()=>({})}},computed:{selectedNode(){return this.$store.state.selectedNode},select(){return this.config.assignedUser||[]},nowNodeLeave(){return this.prioritySortList.indexOf(this.selectedNode)},prioritySortList(){let e=this.$store.state.nodeMap.get(this.selectedNode.parentId);return console.log(this.selectedNode.id,e),e&&e.branchs||[]}},data(){return{sortOption:{animation:300,chosenClass:"choose",scroll:!0,sort:!0}}},methods:{addConditionGroup(){this.config.groups.push({cids:[],groupType:"OR",conditions:[]})},selectUser(){this.showOrgSelect=!0},selected(e){console.log(e),this.showOrgSelect=!1,e.forEach(e=>this.select.push(e))},removeOrgItem(e){this.select.splice(e,1)}}},ns=ls,rs=(i("3540"),Object(c["a"])(ns,Xi,Zi,!1,null,"ddb06240",null)),as=rs.exports,cs=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticStyle:{"margin-bottom":"20px"}},[t("p",{staticClass:"item-desc"},[e._v("延时方式")]),t("el-radio-group",{attrs:{size:"small"},model:{value:e.config.type,callback:function(t){e.$set(e.config,"type",t)},expression:"config.type"}},[t("el-radio-button",{attrs:{label:"FIXED"}},[e._v("固定时长")]),t("el-radio-button",{attrs:{label:"AUTO"}},[e._v("自动计算")])],1)],1),"FIXED"===e.config.type?t("div",[t("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"时间单位",size:"small",type:"number"},model:{value:e.config.time,callback:function(t){e.$set(e.config,"time",t)},expression:"config.time"}},[t("el-select",{staticStyle:{width:"75px"},attrs:{slot:"append",placeholder:"请选择"},slot:"append",model:{value:e.config.unit,callback:function(t){e.$set(e.config,"unit",t)},expression:"config.unit"}},[t("el-option",{attrs:{label:"天",value:"D"}}),t("el-option",{attrs:{label:"小时",value:"H"}}),t("el-option",{attrs:{label:"分钟",value:"M"}})],1)],1),t("span",{staticClass:"item-desc"},[e._v(" 后进入下一步")])],1):t("div",{staticClass:"item-desc"},[t("el-time-picker",{staticStyle:{width:"150px"},attrs:{"value-format":"HH:mm:ss",size:"small",placeholder:"任意时间点"},model:{value:e.config.dateTime,callback:function(t){e.$set(e.config,"dateTime",t)},expression:"config.dateTime"}}),t("span",{staticClass:"item-desc"},[e._v(" 后进入下一步")])],1)])},ds=[],us={name:"DelayNodeConfig",components:{},props:{config:{type:Object,default:()=>({})}},data(){return{}},methods:{}},ps=us,ms=Object(c["a"])(ps,cs,ds,!1,null,"95317f08",null),hs=ms.exports,fs=function(){var e=this,t=e._self._c;return t("div",[t("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary",round:""},on:{click:e.selectOrg}},[e._v("选择抄送人")]),t("div",{staticClass:"option"},[t("el-checkbox",{attrs:{label:"允许发起人添加抄送人"},model:{value:e.config.shouldAdd,callback:function(t){e.$set(e.config,"shouldAdd",t)},expression:"config.shouldAdd"}})],1),t("org-items",{model:{value:e.select,callback:function(t){e.select=t},expression:"select"}}),t("org-picker",{ref:"orgPicker",attrs:{multiple:"",selected:e.select},on:{ok:e.selected}})],1)},vs=[],gs={name:"CcNodeConfig.vue",components:{OrgPicker:f["a"],OrgItems:Hi},props:{config:{type:Object,default:()=>({})}},computed:{select:{get(){return this.config.assignedUser||[]},set(e){this.config.assignedUser=e}}},data(){return{}},methods:{selectOrg(){this.$refs.orgPicker.show()},selected(e){console.log(e),this.select=Object.assign([],e)},removeOrgItem(e){this.select.splice(e,1)}}},bs=gs,ys=(i("bb50"),Object(c["a"])(bs,fs,vs,!1,null,"9316d1ea",null)),_s=ys.exports,ks=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{attrs:{"label-position":"top","label-width":"90px"}},[t("el-form-item",{staticClass:"user-type",attrs:{label:"选择触发的动作",prop:"text"}},[t("el-radio-group",{model:{value:e.config.type,callback:function(t){e.$set(e.config,"type",t)},expression:"config.type"}},[t("el-radio",{attrs:{label:"WEBHOOK"}},[e._v("发送网络请求")]),t("el-radio",{attrs:{label:"EMAIL"}},[e._v("发送邮件")])],1)],1),"WEBHOOK"===e.config.type?t("div",[t("el-form-item",{attrs:{label:"请求地址",prop:"text"}},[t("el-input",{attrs:{placeholder:"请输入URL地址",size:"medium"},model:{value:e.config.http.url,callback:function(t){e.$set(e.config.http,"url",t)},expression:"config.http.url"}},[t("el-select",{staticStyle:{width:"85px"},attrs:{slot:"prepend",placeholder:"URL"},slot:"prepend",model:{value:e.config.http.method,callback:function(t){e.$set(e.config.http,"method",t)},expression:"config.http.method"}},[t("el-option",{attrs:{label:"GET",value:"GET"}}),t("el-option",{attrs:{label:"POST",value:"POST"}}),t("el-option",{attrs:{label:"PUT",value:"PUT"}}),t("el-option",{attrs:{label:"DELETE",value:"DELETE"}})],1)],1)],1),t("el-form-item",{attrs:{label:"Header请求头",prop:"text"}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("span",{staticStyle:{"margin-right":"10px"}},[e._v("Header请求头")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.addItem(e.config.http.headers)}}},[e._v(" + 添加")])],1),e._l(e.config.http.headers,(function(i,s){return t("div",{key:i.name},[e._v(" - "),t("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"参数名",size:"small"},model:{value:i.name,callback:function(t){e.$set(i,"name",t)},expression:"header.name"}}),t("el-radio-group",{staticStyle:{margin:"0 5px"},attrs:{size:"small"},model:{value:i.isField,callback:function(t){e.$set(i,"isField",t)},expression:"header.isField"}},[t("el-radio-button",{attrs:{label:!0}},[e._v("表单")]),t("el-radio-button",{attrs:{label:!1}},[e._v("固定")])],1),i.isField?t("el-select",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请选择表单字段"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"header.value"}},e._l(e.forms,(function(e){return t("el-option",{key:e.id,attrs:{label:e.title,value:e.title}})})),1):t("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请设置字段值",size:"small"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"header.value"}}),t("el-icon",{staticClass:"el-icon-delete",staticStyle:{"margin-left":"5px",color:"#c75450",cursor:"pointer"},on:{click:function(t){return e.delItem(e.config.http.headers,s)}}})],1)}))],2),t("el-form-item",{attrs:{label:"Header请求参数",prop:"text"}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("span",{staticStyle:{"margin-right":"10px"}},[e._v("Header请求参数 ")]),t("el-button",{staticStyle:{"margin-right":"20px"},attrs:{type:"text"},on:{click:function(t){return e.addItem(e.config.http.params)}}},[e._v(" + 添加")]),t("span",[e._v("参数类型 - ")]),t("el-radio-group",{staticStyle:{margin:"0 5px"},attrs:{size:"mini"},model:{value:e.config.http.contentType,callback:function(t){e.$set(e.config.http,"contentType",t)},expression:"config.http.contentType"}},[t("el-radio-button",{attrs:{label:"JSON"}},[e._v("json")]),t("el-radio-button",{attrs:{label:"FORM"}},[e._v("form")])],1)],1),e._l(e.config.http.params,(function(i,s){return t("div",{key:i.name},[e._v(" - "),t("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"参数名",size:"small"},model:{value:i.name,callback:function(t){e.$set(i,"name",t)},expression:"param.name"}}),t("el-radio-group",{staticStyle:{margin:"0 5px"},attrs:{size:"small"},model:{value:i.isField,callback:function(t){e.$set(i,"isField",t)},expression:"param.isField"}},[t("el-radio-button",{attrs:{label:!0}},[e._v("表单")]),t("el-radio-button",{attrs:{label:!1}},[e._v("固定")])],1),i.isField?t("el-select",{staticStyle:{width:"180px"},attrs:{size:"small",placeholder:"请选择表单字段"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"param.value"}},e._l(e.forms,(function(e){return t("el-option",{key:e.id,attrs:{label:e.title,value:e.title}})})),1):t("el-input",{staticStyle:{width:"180px"},attrs:{placeholder:"请设置字段值",size:"small"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"param.value"}}),t("el-icon",{staticClass:"el-icon-delete",staticStyle:{"margin-left":"5px",color:"#c75450",cursor:"pointer"},on:{click:function(t){return e.delItem(e.config.http.params,s)}}})],1)})),t("div")],2),t("el-form-item",{attrs:{label:"请求结果处理",prop:"text"}},[t("div",{attrs:{slot:"label"},slot:"label"},[t("span",[e._v("请求结果处理")]),t("span",{staticStyle:{"margin-left":"20px"}},[e._v("自定义脚本: ")]),t("el-switch",{model:{value:e.config.http.handlerByScript,callback:function(t){e.$set(e.config.http,"handlerByScript",t)},expression:"config.http.handlerByScript"}})],1),e.config.http.handlerByScript?t("span",{staticClass:"item-desc"},[e._v(" 👉 返回值为 ture 则流程通过，为 false 则流程将被驳回 "),t("div",[e._v("支持函数 "),t("span",{staticStyle:{color:"dodgerblue"}},[e._v("setFormByName( "),t("span",{staticStyle:{color:"#939494"}},[e._v("'表单字段名', '表单字段值'")]),e._v(" )")]),e._v(" 可改表单数据 ")])]):t("span",{staticClass:"item-desc"},[e._v("👉 无论请求结果如何，均通过")]),e.config.http.handlerByScript?t("div",[t("div",[t("span",[e._v("请求成功😀：")]),t("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.config.http.success,callback:function(t){e.$set(e.config.http,"success",t)},expression:"config.http.success"}})],1),t("div",[t("span",[e._v("请求失败😥：")]),t("el-input",{attrs:{type:"textarea",rows:3},model:{value:e.config.http.fail,callback:function(t){e.$set(e.config.http,"fail",t)},expression:"config.http.fail"}})],1)]):e._e()])],1):"EMAIL"===e.config.type?t("div",[t("el-form-item",{attrs:{label:"邮件主题",prop:"text"}},[t("el-input",{attrs:{placeholder:"请输入邮件主题",size:"medium"},model:{value:e.config.email.subject,callback:function(t){e.$set(e.config.email,"subject",t)},expression:"config.email.subject"}})],1),t("el-form-item",{attrs:{label:"收件方",prop:"text"}},[t("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",multiple:"","allow-create":"","default-first-option":"",placeholder:"请输入收件人"},model:{value:e.config.email.to,callback:function(t){e.$set(e.config.email,"to",t)},expression:"config.email.to"}},e._l(e.config.email.to,(function(e){return t("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),t("el-form-item",{attrs:{label:"邮件正文",prop:"text"}},[t("el-input",{attrs:{type:"textarea",rows:4,placeholder:"邮件内容，支持变量提取表单数据 ${表单字段名} "},model:{value:e.config.email.content,callback:function(t){e.$set(e.config.email,"content",t)},expression:"config.email.content"}})],1)],1):e._e()],1)],1)},xs=[],Ss={name:"TriggerNodeConfig",components:{},props:{config:{type:Object,default:()=>({})}},computed:{forms(){return this.$store.state.design.formItems||[]}},data(){return{cmOptions:{tabSize:4,indentUnit:4,styleActiveLine:!0,lineNumbers:!0,styleSelectedText:!0,line:!0,foldGutter:!0,gutters:["CodeMirror-linenumbers","lock","warn"],highlightSelectionMatches:{showToken:/w/,annotateScrollbar:!0},mode:"javascript",hintOptions:{completeSingle:!1},keyMap:"sublime",matchBrackets:!0,showCursorWhenSelecting:!1,theme:"material",extraKeys:{Ctrl:"autocomplete"},lastLineBefore:0}}},methods:{addItem(e){e.length>0&&(""===e[e.length-1].name.trim()||""===e[e.length-1].value.trim())?this.$message.warning("请完善之前项后在添加"):e.push({name:"",value:"",isField:!0})},delItem(e,t){e.splice(t,1)},onCmCodeChange(){},onCmReady(){}}},ws=Ss,Cs=(i("6ef6"),Object(c["a"])(ws,ks,xs,!1,null,"0337be07",null)),Ns=Cs.exports,$s=function(){var e=this,t=e._self._c;return t("div",[t("el-table",{staticStyle:{width:"100%"},attrs:{"header-cell-style":{background:"#f5f6f6"},data:e.formPerms,border:""}},[t("el-table-column",{attrs:{prop:"title","show-overflow-tooltip":"",label:"表单字段"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",[i.row.required?t("span",{staticStyle:{color:"#c75450"}},[e._v(" * ")]):e._e(),t("span",[e._v(e._s(i.row.title))])]),t("span",{staticStyle:{color:"#cccc"}},[e._v(e._s(i.row.id))])]}}])}),t("el-table-column",{attrs:{prop:"readOnly",label:"只读",width:"80"},scopedSlots:e._u([{key:"header",fn:function(i){return[t("el-radio",{attrs:{label:"R"},on:{change:function(t){return e.allSelect("R")}},model:{value:e.permSelect,callback:function(t){e.permSelect=t},expression:"permSelect"}},[e._v("只读")])]}},{key:"default",fn:function(i){return[t("el-radio",{attrs:{label:"R",name:i.row.id},model:{value:i.row.perm,callback:function(t){e.$set(i.row,"perm",t)},expression:"scope.row.perm"}})]}}])}),"CC"!==e.nowNode.type?t("el-table-column",{attrs:{prop:"editable",label:"可编辑",width:"90"},scopedSlots:e._u([{key:"header",fn:function(i){return[t("el-radio",{attrs:{label:"E"},on:{change:function(t){return e.allSelect("E")}},model:{value:e.permSelect,callback:function(t){e.permSelect=t},expression:"permSelect"}},[e._v("可编辑")])]}},{key:"default",fn:function(i){return[t("el-radio",{attrs:{label:"E",name:i.row.id},model:{value:i.row.perm,callback:function(t){e.$set(i.row,"perm",t)},expression:"scope.row.perm"}})]}}],null,!1,2030366288)}):e._e(),t("el-table-column",{attrs:{prop:"hide",label:"隐藏",width:"80"},scopedSlots:e._u([{key:"header",fn:function(i){return[t("el-radio",{attrs:{label:"H"},on:{change:function(t){return e.allSelect("H")}},model:{value:e.permSelect,callback:function(t){e.permSelect=t},expression:"permSelect"}},[e._v("隐藏")])]}},{key:"default",fn:function(i){return[t("el-radio",{attrs:{label:"H",name:i.row.id},model:{value:i.row.perm,callback:function(t){e.$set(i.row,"perm",t)},expression:"scope.row.perm"}})]}}])})],1)],1)},Os=[],Is=(i("1e70"),i("79a4"),i("c1a1"),i("8b00"),i("a4e7"),i("1e5a"),i("72c3"),{name:"FormAuthorityConfig",components:{},data(){return{tableData:[],isIndeterminate:!1,permSelect:"",checkStatus:{readOnly:!0,editable:!1,hide:!1}}},created(){let e=this.formPerms.toMap("id");this.formPerms.length=0;const{formItems:t}=this.$store.state.design;this.formPermsLoad(e,t)},computed:{nowNode(){return this.$store.state.selectedNode},formData(){return this.$store.state.design.formItems},formPerms(){return this.$store.state.selectedNode.props.formPerms}},mounted(){},methods:{allSelect(e){this.permSelect=e,this.formPerms.forEach(t=>t.perm=e)},formPermsLoad(e,t){t.forEach(t=>{if(console.log("form item:",t),"SpanLayout"===t.name)this.formPermsLoad(e,t.props.items);else{let i=e.get(t.id);i?(i.title=t.title,i.required=t.props.required,this.formPerms.push(i)):this.formPerms.push({id:t.id,title:t.title,required:t.props.required,perm:"ROOT"===this.$store.state.selectedNode.type?"E":"R"})}})},handleCheckAllChange(){}},watch:{formPerms:{deep:!0,handler(){const e=new Set(this.formPerms.map(e=>e.perm));this.permSelect=1===e.size?e.values()[0]:""}}}}),Es=Is,Ts=(i("c87a"),Object(c["a"])(Es,$s,Os,!1,null,"464ba201",null)),Ps=Ts.exports,Rs=function(){var e=this,t=e._self._c;return t("div",[t("el-alert",{attrs:{title:"表单字段设置说明",type:"info",description:"可设置本节点要强制更新的字段值，支持EJS表达式（<%=XX%>），表达式上下文为整个表单，可以通过变量获取其他字段值，也可以支持其他函数。如：moment日期格式化","show-icon":""}}),t("el-table",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{"header-cell-style":{background:"#f5f6f6"},data:e.formVariables,border:""}},[t("el-table-column",{attrs:{"show-overflow-tooltip":"",label:"表单字段",width:"170"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{placeholder:"输入字段英文ID",name:"id",size:"medium"},model:{value:i.row.id,callback:function(t){e.$set(i.row,"id",t)},expression:"scope.row.id"}})]}},{key:"header",fn:function(i){return[e._v(" 表单字段 "),t("el-button",{staticClass:"icon-btn",attrs:{icon:"el-icon-circle-plus-outline"},on:{click:e.addRow}})]}}])}),t("el-table-column",{attrs:{label:"字段值"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-input",{attrs:{placeholder:"输入字段值，支持ejs表达式",name:"value",size:"medium"},model:{value:i.row.value,callback:function(t){e.$set(i.row,"value",t)},expression:"scope.row.value"}})]}}])}),t("el-table-column",{attrs:{label:"操作",width:"50",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{staticClass:"icon-btn",attrs:{icon:"el-icon-delete"},on:{click:function(t){return e.delRow(i.$index)}}})]}}])})],1)],1)},Ls=[],zs={name:"FormVariableConfig",components:{},data(){return{tableData:[],isIndeterminate:!1,permSelect:"",checkStatus:{readOnly:!0,editable:!1,hide:!1}}},created(){},computed:{nowNode(){return this.$store.state.selectedNode},formData(){return this.$store.state.design.formItems},formVariables(){return this.$store.state.selectedNode.props.formVariables}},mounted(){},methods:{addRow(){this.formVariables.push({id:"",value:""})},delRow(e){this.formVariables.splice(e,1)},handleCheckAllChange(){}},watch:{}},Ds=zs,As=(i("44da"),Object(c["a"])(Ds,Rs,Ls,!1,null,"36807e8e",null)),Us=As.exports,js=function(){var e=this,t=e._self._c;return t("div",[t("p",{staticClass:"desc"},[e._v("选择能发起该审批的人员/部门，不选则默认开放给所有人")]),t("el-button",{attrs:{size:"mini",icon:"el-icon-plus",type:"primary",round:""},on:{click:e.selectOrg}},[e._v("请选择")]),t("org-items",{model:{value:e.select,callback:function(t){e.select=t},expression:"select"}}),t("org-picker",{ref:"orgPicker",attrs:{title:"请选择可发起本审批的人员/部门",multiple:"",selected:e.select},on:{ok:e.selected}})],1)},Fs=[],Ms={name:"RootConfig",components:{OrgPicker:f["a"],OrgItems:Hi},props:{config:{type:Object,default:()=>({})}},data(){return{showOrgSelect:!1}},computed:{select(){return this.config.assignedUser}},methods:{selectOrg(){this.$refs.orgPicker.show()},selected(e){this.select.length=0,e.forEach(e=>this.select.push(e))},removeOrgItem(e){this.select.splice(e,1)}}},Bs=Ms,Vs=(i("4894"),Object(c["a"])(Bs,js,Fs,!1,null,"0516bea4",null)),Gs=Vs.exports,qs={name:"NodeConfig",components:{Approval:Ki,Condition:as,Trigger:Ns,Delay:hs,Root:Gs,Cc:_s,FormAuthorityConfig:Ps,FormVariablesConfig:Us},data(){return{active:"properties"}},computed:{selectNode(){return this.$store.state.selectedNode},formConfig(){return this.$store.state.design.formItems},name(){switch(this.selectNode.type){case"ROOT":return"设置发起人";case"APPROVAL":return"设置审批人";case"CC":return"设置抄送人";default:return null}}},methods:{}},Hs=qs,Js=Object(c["a"])(Hs,Ei,Ti,!1,null,"4825af6f",null),Ys=Js.exports,Ws={name:"ProcessDesign",components:{ProcessTree:Ii,NodeConfig:Ys},data(){return{scale:100,selected:{},showInput:!1,showConfig:!1}},computed:{selectedNode(){return this.$store.state.selectedNode}},mounted(){},methods:{validate(){return this.$refs["process-tree"].validateProcess()},nodeSelected(e){console.log("配置节点",e),this.showConfig=!0}},watch:{}},Ks=Ws,Xs=(i("c787"),Object(c["a"])(Ks,at,ct,!1,null,"5f9e7e5b",null)),Zs=Xs.exports,Qs=function(){var e=this,t=e._self._c;return t("div",{staticClass:"senior-setup"},[t("el-form",{attrs:{"label-position":"top","label-width":"80px"}},[t("el-form-item",{attrs:{label:"审批同意时是否签字"}},[t("el-switch",{attrs:{"inactive-text":"无需签字","active-text":"需要签字"},model:{value:e.setup.sign,callback:function(t){e.$set(e.setup,"sign",t)},expression:"setup.sign"}}),t("div",{staticClass:"sign-tip"},[e._v("如果此处设置为 "),t("b",[e._v("需要签字")]),e._v("，则所有审批人“同意时” "),t("b",[e._v("必须签字")])])],1)],1)],1)},eo=[],to={name:"FormProSetting",computed:{setup(){return this.$store.state.design.settings}},data(){return{}},methods:{validate(){return[]}}},io=to,so=(i("c8d6"),Object(c["a"])(io,Qs,eo,!1,null,"fd1a9330",null)),oo=so.exports,lo={name:"FormProcessDesign",components:{LayoutHeader:u,FormBaseSetting:_,FormDesignAmis:rt,ProcessDesign:Zs,FormProSetting:oo},data(){return{isNew:!0,validStep:0,timer:null,activeSelect:"baseSetting",validVisible:!1,validResult:{},validOptions:[{title:"基础信息",description:"",icon:"",status:""},{title:"审批表单",description:"",icon:"",status:""},{title:"审批流程",description:"",icon:"",status:""},{title:"扩展设置",description:"",icon:"",status:""}],validComponents:["baseSetting","formSetting","processDesign","proSetting"]}},computed:{setup(){return this.$store.state.design},errTitle(){return this.validResult.finished&&!this.validResult.success?this.validResult.title+` (${this.validResult.errs.length}项错误) 😥`:this.validResult.title},validIcon(){return this.validResult.finished?this.validResult.success?"success":"warning":"el-icon-loading"}},created(){this.showValiding();let e=this.$route.params.processId;this.loadInitFrom(),this.$isNotEmpty(e)&&(this.isNew=!1,this.loadFormInfo(e));let t=this.$route.query.group;this.setup.groupId=this.$isNotEmpty(t)?parseInt(t):null},beforeDestroy(){this.stopTimer()},methods:{findElementFromSchema(e,t){const{body:i=[]}=e;for(const s of i)return s.type===t?s:this.findElementFromSchema(s,t);return null},findFormItems(e){const{body:t=[],columns:i=[]}=e||{},s=t.concat(i);let o=[];for(const l of s)l.body||l.columns?o=o.concat(this.findFormItems(l)):l.type&&o.push(l);return o},loadFormInfo(e){Object(p["a"])(e).then(e=>{console.log("getFormDetail: ",e.data);const{id:t,name:i,groupId:s,icon:o,settings:l,processJson:n,remark:r,formSchema:a}=e.data,c=this.$store.state.design,d=this.findElementFromSchema(JSON.parse(a||"{}"),"form"),u=this.findFormItems(d).sort((e,t)=>"hidden"!==e.type?-1:"hidden"!==t.type?1:0).map(e=>({id:e.name,title:e.label,props:{required:e.required}}));console.log("formItems: ",u),c.formId=t,c.formName=i,c.groupId=s,c.remark=r,c.logo=o?JSON.parse(o):c.logo,c.settings=l?JSON.parse(l):c.settings,c.formItems=u||[],c.process=n?JSON.parse(n):c.process,this.$store.commit("loadForm",c)}).catch(e=>{console.error(e),this.$message.error(e)})},loadInitFrom(){this.$store.commit("loadForm",{formId:null,formName:"未命名表单",logo:{icon:"el-icon-eleme",background:"#1e90ff"},settings:{commiter:[],admin:[],sign:!1,notify:{types:["APP"],title:"消息通知标题"}},groupId:void 0,formItems:[],process:{id:"root",parentId:null,type:"ROOT",name:"发起人",desc:"任何人",props:{assignedUser:[],formPerms:[],formVariables:[]},children:{}},remark:"备注说明"})},validateDesign(){this.validVisible=!0,this.validStep=0,this.showValiding(),this.stopTimer(),this.timer=setInterval(()=>{this.validResult.errs=this.$refs[this.validComponents[this.validStep]].validate(),Array.isArray(this.validResult.errs)&&0===this.validResult.errs.length?(this.validStep++,this.validStep>=this.validOptions.length&&(this.stopTimer(),this.showValidFinish(!0))):(this.stopTimer(),this.validOptions[this.validStep].status="error",this.showValidFinish(!1,this.getDefaultValidErr()))},300)},getDefaultValidErr(){switch(this.validStep){case 0:return"请检查基础设置项";case 1:return"请检查审批表单相关设置";case 2:return"请检查审批流程，查看对应标注节点错误信息";case 3:return"请检查扩展设置";default:return"未知错误"}},showValidFinish(e,t){this.validResult.success=e,this.validResult.finished=!0,this.validResult.title=e?"校验完成 😀":"校验失败 ",this.validResult.desc=e?"设置项校验成功，是否提交？":t,this.validResult.action=e?"提 交":"去修改"},showValiding(){this.validResult={errs:[],finished:!1,success:!1,title:"检查中...",action:"处理",desc:"正在检查设置项"},this.validStep=0,this.validOptions.forEach(e=>{e.status="",e.icon="",e.description=""})},doAfter(){this.validResult.success?this.doPublish():(this.activeSelect=this.validComponents[this.validStep],this.validVisible=!1)},stopTimer(){this.timer&&clearInterval(this.timer)},preview(){this.validateDesign()},publishProcess(){this.validateDesign()},doPublish(){this.$confirm("如果您只想预览请选择预览，确认发布后流程立即生效，是否继续?","提示",{confirmButtonText:"发布",cancelButtonText:"取消",type:"warning"}).then(()=>{console.log(this.setup);let e={id:this.setup.formId,name:this.setup.formName,icon:JSON.stringify(this.setup.logo),groupId:this.setup.groupId,processJson:JSON.stringify(this.setup.process),remark:this.setup.remark,settings:JSON.stringify(this.setup.settings)};this.isNew||!this.$isNotEmpty(this.setup.formId)||Object(p["e"])(e).then(e=>{this.$message.success("更新表单成功"),this.validVisible=!1,console.log("流程发布结果：",e.data),this.$router.replace("/admin/design/"+e.data.id)}).catch(e=>{console.error(e),this.$message.error(e)})})}}},no=lo,ro=(i("d66d"),Object(c["a"])(no,s,o,!1,null,"5814881e",null));t["default"]=ro.exports},e8df:function(e,t,i){},e9bc:function(e,t,i){"use strict";var s=i("dc19"),o=i("cb27").add,l=i("83b9"),n=i("7f65"),r=i("5388");e.exports=function(e){var t=s(this),i=n(e).getIterator(),a=l(t);return r(i,(function(e){o(a,e)})),a}},edd1:function(e,t,i){},f405:function(e,t,i){},f5df:function(e,t,i){"use strict";var s=i("00ee"),o=i("1626"),l=i("c6b6"),n=i("b622"),r=n("toStringTag"),a=Object,c="Arguments"===l(function(){return arguments}()),d=function(e,t){try{return e[t]}catch(i){}};e.exports=s?l:function(e){var t,i,s;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=d(t=a(e),r))?i:c?l(t):"Object"===(s=l(t))&&o(t.callee)?"Arguments":s}},fcc0:function(e,t,i){},fd73:function(e,t,i){}}]);
//# sourceMappingURL=chunk-6e962eb4.8837d52b.js.map